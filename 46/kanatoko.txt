x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x

--- 第○章: Black Hat Europe 2009 ﾚﾎﾟｰﾄ ---

著者：金床

x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x


■0x00.) はじめに

　4月の中旬にアムステルダムでBlack Hat Europe（BHE）が開催された。誰でも
人生のうち一度は巡礼せねばならぬとされる聖地アムス。筆者はｻｰﾊﾞｰ管理の仕事
を同僚に押しつけると、一週間ほどの聖地巡礼ﾂｱｰを敢行したのである。


■0x01.) ｼｰｸﾙﾏｯﾌﾟ

　（…悪いが、話はいきなりBHEの真っ最中に飛ぶ。まぁ、ｱﾑｽでBHE以外に何やっ
てたかは書くまでもない。そう、チューリップの閲覧、風車を主題とした力学の
基礎の習得、そして木靴制作だ。よく「ｱﾑｽ=葉っぱ」とか「ｱﾑｽ=飾り窓」とか思
ってるﾔｼがいるけど、そういう人は「葉っぱ」「日記」でｸﾞｸﾞるとそれっぽいｻｲ
ﾄが出てくるからそっちを見てくれよな。）

　さてｼｰｸﾙﾏｯﾌﾟはsqlmapのことだ。SQLインジェクションの検査に使える有名な
（？）ツールである。今回のBHEではこのsqlmapの作者であるﾍﾞﾙﾅﾙﾄﾞなんとか（
読めない）がｽﾋﾟｰｶｰとして登場した。数少ないWAS(web app sec)関連のｾｯｼｮﾝだっ
たので筆者は当然参加したのである。ｾｯｼｮﾝのﾀｲﾄﾙは「Advanced SQL injection 
to operating system full control」だ。まさか、またSQLインジェクションする
ための新しい手法が発見されたのか？とwktkしながら最前列で話をきいた。

　しかし結論から書くと、「SQLインジェクションがある場合にはこんなに傷口を
広げられますよ」という方向でのセッションであった。SQLｲﾝｼﾞｪｸｼｮﾝそのものを
実現するための新しい手法ではなく、あくまで脆弱性がある場合のﾈﾀだ。今まで
知られていない方法でRDBMS経由でシステムの制御を奪うような話であり、技術的
な詳細まで適切に説明してくれたので、筆者としてはなかなか楽しめた。

　彼はRDBMS経由でシステムコマンドを実行するためにユーザ定義関数（UDF）を
使用する手法を編み出した。MySQLやPostgreSQL上で実行されるSQLから、共有ラ
イブラリ（.dllファイルなど）を目標のシステム上にアップロードし（ﾌｧｲﾙを書
き込み）、その中に定義された関数をUDFから呼び出すのである。これはかなり
目からウロコの攻撃手法であった。デモも華麗に決まり、SQL経由でシステムコ
マンドが実行された。

　筆者も拙著「ウェブアプリケーションセキュリティ」でPostgreSQL上のPL/Per
lUを利用してシステムコマンドを実行する例を発表したが、その手法に比べると、
あらかじめパッケージ化されているPostgreSQLへの攻撃などで有利とのことであ
る（パッケージ化されたPostgreSQLではPL/PerlUが有効になっていないｹｰｽが殆ど
とのこと）。それに、この手法はMySQLでも使うことができる。

　ﾍﾞﾙﾅﾙﾄﾞはいかにも英国という感じの英語で話していた。「data」が「ダータ」
だったりしてかなり強烈だった。

　資料などはこちら
　http://www.blackhat.com/html/bh-europe-09/bh-eu-09-archives.html#Damele


■0x02.) ﾌｫｶ

　続いて紹介するのはﾒﾀﾃﾞｰﾀに関するｾｯｼｮﾝである。ｴｸｾﾙやﾜｰﾄﾞなどのｵﾌｨｽﾄﾞｷｭﾒ
ﾝﾄはもちろん、pdf、jpegのような画像ﾌｧｲﾙまで、ﾌｧｲﾙを作成した人自身が意識し
ていないﾃﾞｰﾀを含むﾌｧｲﾙ形式は数多い。Googleなどでは多数のｵﾌｨｽﾄﾞｷｭﾒﾝﾄやpdf
が入手できるため、それらからﾒﾀﾃﾞｰﾀを抽出し、面白そうなものがないかを探す
ことが可能である。ｽﾍﾟｲﾝから来た陽気な二人組のｾｯｼｮﾝは、このﾒﾀﾃﾞｰﾀを主題と
したものだ。

　企業などが各種のﾌｧｲﾙをインターネット上で公開する際には、これらのﾒﾀﾃﾞｰﾀ
の中身についても把握し管理する必要があるだろう。筆者はMSｵﾌｨｽは基本的には
あまり使わないのだが、どうしても仕事の内容上使わざるを得ない場合も存在す
る。このようなときはあまり深く考えずにﾌｧｲﾙを作ってﾒｰﾙで送ったりしてしまう
が、もしかしたらﾒﾀﾃﾞｰﾀの中にとんでもない情報が入ったりしていなかっただろ
うかと不安になった。これらのﾒﾀﾃﾞｰﾀを可視化し、必要に応じて選択して削除で
きるようなﾂｰﾙが今後ﾒｼﾞｬｰになってくるだろうと感じた。

　彼らはFOCAと名付けられたﾂｰﾙとｵﾝﾗｲﾝｻｰﾋﾞｽを公開したので、少し触ってみると
面白いかもしれない。これはﾌｧｲﾙに含まれるﾒﾀﾃﾞｰﾀを抽出するものだ。筆者が試
そうとしたときにはﾂｰﾙはうまくﾀﾞｳﾝﾛｰﾄﾞできなかったが、ｵﾝﾗｲﾝ版は機能してい
た。ただし日本語については化けてしまっているようだった。

　彼らはいかにもｽﾍﾟｲﾝといった感じの巻き舌の英語でﾎﾞｹ・ﾂｯｺﾐを繰り返し、絶
えず聴衆を笑わせていた。さまざまな人種の多彩な英語でｾｯｼｮﾝが行われるのが、
いかにもBHEという感じだった。

　資料などはこちら
　http://www.blackhat.com/html/bh-europe-09/bh-eu-09-archives.html#Alonso


■0x03.) WAFﾈﾀ

　ｱﾑｽまで来てﾖｶｯﾀと思わせてくれたのがｲﾀﾘｱｰﾉWAF（なんだそれ）である。ﾐﾗﾉ
（大学？）から来た2人組は、ﾎﾜｲﾄﾘｽﾄ方式・ﾌﾞﾗｯｸﾘｽﾄ方式のWAFともに完璧ではな
いと前置きした上で、高度なｱﾉﾏﾘ検知を行うWAFについて研究を行っており、その
内容について発表を行った。どうせなら実用にかなり近いﾚﾍﾞﾙまで持ってきてか
ら発表してくれればと思わないでもなかったが、その中身は非常に興味深いもの
だった。

　彼らがウリにしている点の1つが「通常の（正常な）通信と、攻撃の通信の両方
が入り乱れた場所においても学習していくことができる」というエンジンである
（たしか、正常な通信の方が多ければOKと言っていた気がする）。リクエスト中
の各情報を分析し、それが他の大多数のリクエストと似たパターンを持つか、あ
るいは「距離が離れた」パターンを持つか、などを調べることでｱﾉﾏﾘ検知を行う
らしい。具体的な技術的詳細は筆者には難しくて理解不能なので、興味がある人
はぜひ資料を見ていただきたい。

　また、ﾚｽﾎﾟﾝｽ中のHTMLのﾀｸﾞ構造を解析し、それらの傾向に着目するｴﾝｼﾞﾝも考
えているらしい（筆者はｲｹﾋﾟｮﾝさんのｽｷｬﾅｰを思い出した）。

　いかにも研究者らしい発想のこのWAFがどの程度の実用製を持つのか、これから
動向を追っていくつもりである。筆者もWAFの開発者なので、このｾｯｼｮﾝを聴いて
いる最中にはさまざまなｱｲﾃﾞｱが浮かんできて楽しむことができた。ｲﾝｽﾊﾟｲｱｯ-(ﾟдﾟ) ｯﾄﾞ!!

　しかしｲﾀﾘｱ人なのに英語ﾍﾟﾗﾍﾟﾗでした。ﾏｼﾝｶﾞﾝﾄｰｸ。ﾖｰﾛｯﾊﾟの人はみんな英語
うまいなぁ…

　資料などはこちら
　http://www.blackhat.com/html/bh-europe-09/bh-eu-09-archives.html#Zanero


■0x04.) 他のｾｯｼｮﾝ

　他にもいくつかのｾｯｼｮﾝを見たのだが、ｼﾞｬﾝﾙ的に興味がないものが多かったの
で既に覚えていない（筆者の記憶が消し飛ぶ速度はかなり速く、ほとんど病気な
ﾚﾍﾞﾙ）。Linuxのexploitﾈﾀのｾｯｼｮﾝではｶﾅﾘー値を使うスタックプロテクションを
「Cookie」って呼んでいて、ﾌｰﾝ同じ意味なんだ？とか思ったくらいだろうか…。
あ、あとSSLのやつは思ったより面白くなかったなぁ…。


■0x05.) いろいろ

　そういえば、今年は残念なことにBlack Hat Japanはないらしい。まぁ、ここ数
年、参加者が増えていく気配が感じられなかったのでﾅｯﾄｸしてしまう。Black Hat
の雰囲気や内容が好きなので、BHEに行っておいてよかった。そのBHEも来年はｱﾑｽ
ではなくﾊﾞﾙｾﾛﾅになるとか。

　ｱﾑｽではBHJで知り合いになったｽﾀｯﾌ（ﾄﾗﾋﾞｽとかﾄﾞﾐﾆｸとかｼﾞｪﾌとか）がよくし
てくれた。ﾄﾗﾋﾞｽなんか筆者が受付していたら割り込んできてhackerﾀｸﾞ付けてく
れたりして、底なしにｲｲ人である。ｼﾞｪﾌとはｽﾍﾟｰｽとｺｽﾞﾐｯｸの違いについて議論し
た（謎。

　日本人の参加者は筆者だけだったらしい。他に中国人が数人、韓国人が数人い
たようだ。韓国の人とは休憩時間に少し話をすることができた。どうやら会社の
経費で来ているらしく、去年のBHJにも来たと言っていた。POCとかのことはあま
りしらないようだった。

　ｱﾑｽでまいったのはｺｰﾋｰがまずいことである。結局滞在している一週間、まとも
なｺｰﾋｰには一杯もありつけなかった。なんか酸っぱいというかとにかくﾀﾞﾒなので
ある。というかあれはｺｰﾋｰではなく別の飲み物（ｺｰﾋｰ茶みたいなもの）だったに
違いない。最悪ｽﾀﾊﾞがあればｼｮｯﾄ追加のｱﾒﾘｶｰﾉで逃げることができたのだが、ｱﾑ
ｽにはどうもｽﾀﾊﾞはないらしい。ﾄﾞﾐﾆｸに「ｽﾀﾊﾞないの？」ってきいたら「ｽｷﾎﾟｰﾙ
まで逝けばあるよ。電車で15分くらいだよ」って言われたし…めんどくさいから
行くわけないし。ｽｷﾎﾟｰﾙのｽﾀﾊﾞはもちろん成田から到着時に速攻でﾁｪｯｸしてあっ
たのでそれは知っていたし。

　そして予想どおりｱﾑｽのﾒｼはまずかった。正確には別にマズくはないのだがおい
しくなかった。BHEの昼飯もｲﾏｲﾁ、ｵﾀﾙとかいうｽｼも食える店もまずかったし、中
華料理屋もぱっとしなかった。ﾊﾟﾝ屋さんで買ってきたﾊﾟﾝも日本に比べるとﾏｽﾞｲ。
滞在中いちばん旨かったのはホテルの朝食（バイキング形式）で食べることがで
きるｸﾞﾚｰﾌﾟﾌﾙｰﾂ。オランダはｸﾞﾚｰﾌﾟﾌﾙｰﾂがｳﾏいのか、意外だ…と思っていたら貼
ってあったシールにフロリダって書いてあった件について。

　BHEはBHJに似た規模で、予想していたより人が少ない。雰囲気はアットホーム
で、スピーカーも簡単に捕まえて話をきくことができる感じ。ただ日本とは異な
りスーツ着てる人は皆無。というかアムスにスーツの人が皆無ｗ　ﾄｷｵｰ帰ってき
たらﾏｼﾞスーツ多いよ…。前にMSの人が「黒いスーツが多くてﾋﾞﾋﾞった」って言っ
てのﾅｯﾄｸした…。



