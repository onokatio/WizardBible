

ユーザ名の収集と利用


ー　目次　ー
  1. 始めに
  2. ユーザを列挙する
  3. ユーザリストの利用価値
  4. JOE アカウント探しと利用
  5. 注意



################################################################################
 1. 始めに 
################################################################################

今回はあるサーバに属するユーザ名を集める方法を一つ紹介したいと思います。その方法は Web サーバに対してしか使えないものの、世間に広まっているレンタルサーバ等の加入ユーザ名を集める場合などにはかなり効率的な結果を出してくれます。その上ターゲットサーバにはユーザ名を収集したことがばれません。

その方法はとても簡単なので、方法を紹介するだけでは記事として面白くありません。ですから今回はそのユーザ名の利用法にも触れたいと思います。大部分を自動化できるようにプログラムも容易したので、スクリプト・キディな方はそちらもどうぞ。

################################################################################
 2. ユーザを列挙する 
################################################################################

まず、ユーザを列挙しなくてはいけません。ユーザを列挙する方法には何通りも有ります IPUSIRON 氏のサイト（参考１）のセキュリティ講座『ユーザ・グループ列挙編』にある方法を紹介しましょう。

(1)  推測によるユーザ・グループ列挙
(2)  メールアドレス利用によるユーザ・グループ列挙
(3)  SMTPのVRFYまたはEXPNコマンド利用によるユーザ・グループ列挙
(4)  finger 利用によるユーザ列挙
(5)  rwhoまたはrusers利用によるユーザ・グループ列挙
(6)  Apache UserDir機能からのユーザ列挙
(7)  Solaris in.ftpdの脆弱性利用によるユーザー列挙
(8)  RedHat Linux 7.[01]のPAM qpopper（RPM版）の脆弱性利用によるユーザー列挙
(9)  sid2user/user2sid利用によるユーザー列挙
(10) enum利用によるユーザー列挙 
(11) ntdump利用によるユーザー列挙
(12) ldp.exe利用によるユーザー列挙
(13) GetAcct利用によるユーザー列挙

いろいろ有りますね。これらの解説はIPUSIRON氏のサイト等を参照して下さい。そして今回紹介する方法は上記リストの (6) の Apache UserDir 機能からのユーザ列挙の応用です。これはいたって簡単で、ターゲットサーバからばれる事も無く、効率的にユーザを列挙出来ます。しかもある条件の中では法律には違反しません。この条件は記事最後の『注意』を御覧下さい。

では、その方法を紹介しましょう。使用するのは Google のみ。Google には検索オプションとしてドメイン内検索というものが有ります。これは xxx.com というサイトの中にあるファイルのみを検索対象にする仕組みです。これは Google のトップページから『検索オプション』に進みドメインを設定するか、検索クエリに『site:<target.com>』と入力すれば利用する事が出来ます。例えば次に示す方法を試して下さい。ちなみにここでテストに使用するターゲットサーバは target-server.com とします。

(1) google に次に示す検索クエリを送る　「site:target-server.com b」
(2) 検索結果である http://targetserver.com/xxx/ の xxx がユーザ名

独自ドメインではなく、レンタルサーバであればほとんど URL のうちの最初のディレクトリはユーザ名を示します。例えば私のサイトがあるサーバ "members.jcom.home.ne.jp" をターゲットとして上記方法で検索すると 40,100 件の検索結果が得られます。もちろん大部分は同一ユーザのサイトですが、全てを調べれば大量のユーザ名が得られる事は容易に想像出来ます。この方法はシンプルですし、目新しい技術も無いですがメリットは以外と多いのです。例えば

・ 相手サーバに一度も触れていない
・ ターゲットサーバを決めて収集できる
・ 合法的である（条件による）

のようなものが挙げられるでしょう。それにしても手動で行うと時間も手間もかかります。Perl などのプログラミング言語が出来ればプログラムを組んで自動化することは容易です。そこで試しに私が作ってみました（google-ulist.pl - http://members.jcom.home.ne.jp/j-klein/src-box/google-ulist.pl）。これは実行時の引数にターゲットホスト名を与えるとそのホストのユーザ名を大量に集めてくれます。そして "ホスト名.txt" という名前で保存してくれます。大変便利で効率的に集める事ができますが、このプログラムは合法ではありません（この記事の最後にある『注意』とソースコード冒頭の説明を読んで下さい）。　

実行例：	perl google-ulist.pl members.jcom.home.ne.jp

私がテスト実行したところ、重複無しで 1851 件のユーザ名が集まりました。そしていろんなレンタルサーバで同様のことを繰り返したところ 29137 件のユーザ名が集まりました(注1)。これだけ有るとユーザのリストもいろいろな利用価値を見出せます。次の章で利用価値について考えてみましょう。

(注1) "members.tripod.com" や "homepage2.nifty.com" など 58 のサーバを調べた結果です。

################################################################################
 3. ユーザリストの利用価値 
################################################################################

『どんなに集めても分かるのはユーザ名だけでは…』そんな声も聞こえてきそうですが、今重要視すべきなのはユーザ名が大量にあることでしょう。実際 1 つ 2 つ分かってもメリットは小さいですが 1000 件単位で見つかると話は違います。考えられる利用方法をあげてみましょう。

(1) JOE アカウント探し
(2) パスワード解析辞書として使用する
(3) ユーザ名からメールアドレスに変換してスパムメールリスト

一つ目の JOE アカウント探しは文字どおりですね。これに関しては後で詳しく書きます。二つ目の『パスワード解析辞書として使用する』というのは未来への投資です。ユーザ名に選ばれるものはパスワードにもなりやすいということを考えれば当然有力な辞書として機能することがわかるでしょう。最後のはスパムメールの対象リストとして使用する方法です。

この中で一番（攻撃者の立場から）有意義な利用法はどのようなものでしょうか。もちろん、JOE アカウント探しでしょう。JOE アカウントでサーバに侵入し、あわよくば権限昇格してサーバを乗っ取るような事も可能です。そうすればあとはしたい放題です。

################################################################################
 4. JOE アカウント探しと利用 
################################################################################

ユーザのリストがあれば JOE アカウントを探すのも簡単です。なぜならこの方法で探したユーザはほぼ確実に FTP アカウントも持っているからです。FTP に対してユーザ名と同様のパスワードを送信し、成功すれば JOE アカウント発見です。簡単ですね。

手動でやるとかなり面倒なことですので、これも自動化してしましょう。ftp-joechek.c は私が作成した JOE 検索用のプログラムです。ダウンロードはこちらからお願いします『http://members.jcom.home.ne.jp/j-klein/src-box/ftp-joecheck.c』。使用方法はソースコードの冒頭に書いてありますので参照して下さい。ちなみに安全性を考え、プロキシを通さないと実行できない様にしてあります。ですので最低一つのプロキシを指定して下さい。そして『1. ユーザを列挙する』で作成したユーザリストファイルをそのまま使用出来ます。その際は次のように実行して下さい。

cat targer-server.com.txt | ftp-joecheck target-server.com proxy-server

これで target-server.com の列挙済みユーザの中から JOE アカウントを見つけてくれます。が、このような事をする前に一つ考えてほしい事が有ります。それはターゲットサーバが JOE アカウントを許可しているかどうかです。例えばユーザ列挙で紹介したサーバ members.jcom.home.ne.jp はユーザ登録時にユーザ名と同様のパスワードを指定するとエラーになり登録出来ません。ですからいくらこの方法を使って JOE を探しても見つからないばかりか、無駄に「警告を受ける」または「逮捕」なんてことにもなりかねません。JOE アカウントを許可しているかどうかは実際にそのサーバに加入している知人にテストしてもらうのが一番でしょう。どんなときでも調査が大事になるという事です。

さて、仮に JOE アカウントが見つかったとしましょう。そこからあなたが出来る事は何があるでしょうか。思い付く事を列挙してみましょう。


● Web ページの改竄 


FTP アカウントは手に入れているのですから簡単でしょう。個人的にはあまり楽しく無いのでお勧めしませんが…。


● Warez 用の FTP アカウント 


Warez には参加した事無いので詳細は分かりませんがこのような利用法もあるでしょう。ただし、このアカウントが長期的に使用されていないことが条件です。でないと、侵入された事が本物のユーザにばれてしまい、パスワード変更されてしまいます。


● リモートログイン 


おそらくこれが最も期待する利用方法でしょう。手に入れたアカウントのあるサーバが telnet や ssh 等のリモートログインを許可している場合にこの方法が利用出来ます。というのもユーザ名とパスワードは既に分かっているのですから、堂々とログインすれば良いのです。

そのサーバに入る事が出来ればする事は一つですね。管理者権限の奪取です。その方法はここでは紹介しきれませんが、ローカルからの奪取の方が簡単なので挑戦する価値は有るかもしれません。


● メールの盗聴 


そのサーバがメールアカウントも発行していれば POP を利用してそのアカウント宛のメールを盗み見る事が出来ます。他人のプライバシーに興味が無くてもメールの盗聴には価値があるときが有ります。何かの会員として加入した際の確認メールが有った場合、その会員情報（あわよくばパスワードも）手に入れる事が出来るからです。例えば、いくつかのレンタルサーバを利用していた場合、芋づる式に全てのサーバへのアカウントを手に入れる事が可能です。他にもそのユーザの本名、役職、電話番号等の個人情報も手に入る確立が高いです。


● CGI が使えるならば 



○ cgi2shell.cgi を使用して仮想シェルを構築 


cgi2shell.cgi というのは PaiN 氏（参考２）が作成した Perl スクリプトで、CGI 上でシェルのような環境を作るプログラムです。UNIX 用と Windows 用があるので是非手に入れておきましょう。


○ CGI + Sendmail で偽造メール 


そのサーバが CGI と sendmail(qmail でも可) を許可していれば完全にあなたの身元を隠して偽造メールを送る事が出来ます。つまり、メール送信用の CGI を作成して FTP でアップロードしてその CGI にアクセスしてメールを送信すればよいのです。


○ さらにユーザを列挙する 


CGI を利用して完全なユーザリストを作成出来ます。これは先ほど紹介した cgi2shell.cgi で "cat /etc/passwd" というコマンドで作成するか、私が作成した ulist.cgi（http://members.jcom.home.ne.jp/j-klein/src-box/uid-lister.cgi） を利用すれば可能です。私が作成した ulist.cgi は UID 総当たりによるユーザ列挙プログラムです。どちらにせよ、Shadow 化されていなければ暗号化されたパスワードが手に入りますので John The Ripper などでパスワードクラックを行うことが出来ます。


蛇足ですが、CGI を使用する際のアドバイスをしておきます。攻撃用の CGI を使う際はくれぐれも怪しい名前でアップロードしないで下さい。例えば前述の cgi2shell.cgi などをそのままの名前で使用すると HTTP サーバのログに残ってしまい、管理者が見た時に怪しく思います。例えば char2.cgi などという名前でアップして使用すれば後からログを見ても怪しまれません。

他にも FTP バウンスアタックに使用したり、本物のユーザが設置した CGI のログを盗んだりといろいろな利用法があるでしょう。是非とも考えてみて下さい。そして是非教えて下さい。

################################################################################
 5. 注意 
################################################################################

ここで、合法かどうかの条件を記しておきます。Google へクエリを送信しユーザを列挙する際に手動で集めるのは通常の検索と同様なので問題有りません。しかしこれをプログラムで組んで自動で収集するとサービス規約に違反するようです。詳しくは次のページの『自動クエリの禁止』を見て下さい。つまるところプログラムから検索を行ってはいけないいけないということでしょう。

Google サービス利用規約　http://www.google.co.jp/intl/ja/terms.html

もう一つ、FTP で JOE アカウントを探すのはそれ自体が違法です。最近の IDS （侵入検知システム）は同じ IP アドレスから何度もログインがあり、そのたびに失敗しているとアラートを出すものも有ります。

参考１："Security Akademeia" - http://akademeia.info/
参考２："- Hex51 -" - http://hex51.darktech.org/

