x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x

--- 第7章: Bookmarkletでインターネットをちょっとだけ快適に ---

著者：えいる

x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x


■0x01.) はじめに

　はじめまして、えいるといいますヽ(´ー｀)ノ
　今回は便利な割には知名度があまり高くない（と思ってる）Bookmarkletについ
て書こうと思います。こんなのすでに常識だったらごめんなさい。


■0x02.) ブックマークレットって？

　Bookmarkletとは、JavaScriptで記述されたコードをブラウザのお気に入りから
任意のページに対して実行できる状態（お気に入りに登録する）にしたものです。
　例えば自分の好きなようにページの色を変えたり、本来ユーザが見ることので
きない（といってもローカルにデータはあるのですが）情報を閲覧したりといっ
たことが可能となります。

　以下ではいくつかのサンプルを見ながら解説をして行こうと思います。なお、
JavaScriptの細かい構文の解説は省いてます。動作確認はIE6です。


■0x03.) 実際のコードと解説

　現在閲覧中のサイトのタイトルを表示させるBookmarkletは次のようになります。

----
javascript:alert(document.title);
----

　上記のコードをコピーしてお気に入りに登録し、任意のページ上でそのお気に
入りを選択します。すると、今見ているサイトのタイトルがダイアログに表示さ
れるはずです。もちろんブラウザの設定でJavascriptの実行を許可する必要があ
ります。コードを分解して、簡単に説明すると以下のようになります。

----
javascript:  //これ以降のコードがJavascriptだということを表す宣言
alert(document.title);  //閲覧中のサイトのタイトルをダイアログで表示する
----

　もう少し複雑なものも作ってみます

----
javascript:(function()
  {var s = "";s = document.cookie; if (s) {
    alert("このページ上のクッキー\n\n" + s);window.clipboardData.setData("text",s);
  } else {
    alert("このページに対してcookieはありません");
  }
})
();
----

　少し構文が増えましたが、あまり変わらないですね。

　現在閲覧しているwebサイトが発行しているクッキーを表示し、クリップボードにコピーします。

----
javascript:(  //これ以降のコードがJavascriptだということを表す宣言
	function(){  //無名関数の宣言
		var s = "";  //変数sの宣言と初期化
		s = document.cookie;  //クッキーの値を変数sに格納
		if (s)  //sの中身が空かどうかの判定
		{  //クッキーが発行されている場合の処理
			alert("このページ上のクッキー\n\n" + s);
                        //クッキーの値を表示する
			window.clipboardData.setData("text",s);
                        //クッキーの値をクリップボードにコピー
		}
		else {  //クッキーが発行されていない場合の処理
			alert("このページに対してcookieはありません");
                        //クッキーが存在しない旨を表示するダイアログ
	})
	();//無名関数の呼び出し
----

　先ほどのコードとの違いは、2行目のfuntionで一度関数を作り、最後に呼び出
しているところですね。もちろん先ほどのように書いても動くのですが、このよ
うに書いたのには理由があります。
　3行目で変数sを宣言していますが、関数を使用せずに宣言すると、見ているサ
イト内で同じ名前の変数が使用されている場合その値を書き換えてしまいます。
そのせいでサイトでのJavaScriptの動作がおかしくなる可能性があるので、関数
の中だけでしか使えないようにしているわけです。もちろん、そういった動作を
させたい場合はその限りではありませんが…。上の例ではクッキーを取得してい
ますが、同じ要領でクッキーを書き換えることも可能です。会員制Webサイトのロ
グインユーザの判定に毎回同じクッキーを発行しているような場合だと、あらか
じめそういったBookmarkletを登録しておくことによりログインを簡単に行うこと
ができますね。

　また、Javascriptがフォーム上のテキストボックスなどにアクセスできること
を利用すると以下のようなコードも書くことができます。

----
javascript:(
function(){
	var s,F,j,f,i;  //変数の宣言
	s = "";  //sの初期化
	F = document.forms;  //Fにフォームへの参照を格納
	for(j=0; j<F.length; ++j) {  //フォームを一つずつ順に読むためのループ
		 f = F[j];  //j番目のフォームへの参照をfに格納
		 for (i=0; i<f.length; ++i) {
                 //フォームの中身を一つずつ順に読むためのループ
		 	if (f[i].type.toLowerCase() == "password")
                        //パスワードの入力ボックスかどうかの判定
		 		 s += f[i].value + "\n";
                                 //入力ボックスの中身を変数sに格納する
		 	}
	}
	if (s)  //パスワードの入力ボックスが存在するならtrue
			alert("このページ上のパスワード\n\n" + s);
                        //変数sの中身をダイアログで表示する
	 else
	 		alert("このページにはパスワードはありません");
})
();
----

　上記のコードではフォームのコントロールを順番に読んでいって、パスワード
の入力フォームがあった場合その内容を表示するようなコードになっています。
パスワードを忘れてしまった場合に使用するといいと思います。
　また、9行目のpasswordをhiddenにすることにより、Webフォーム上にある隠し
項目の内容を表示したり、10行目の処理を「f[i].value="パスワード";」と書き
換えれば、ログイン用のBookmarkletとして使用できると思います。


■0x04.) おわり

　さて、如何でしたでしょうか？
　BookmarkletはJavascriptの構文が使えるので様々なことができます。検索して
みると色々サンプルが見つかるので、JavaScriptのリファレンス（これもネット
上に沢山あります）見ながらいじってみるのも楽しいと思います。自分がよく使
用しているのはページの背景色を変えたりや、ファイルの連番移動などです。

　今回はWindowsアプリケーションやサーバサイドプログラミングよりも手軽には
じめれるプログラミングを紹介してみようと思ったのですが、これで今までプロ
グラムを組んだことが無い人が少しでも興味を持っていただけたら幸いです。

　それでは、お疲れ様でしたヽ(´ー｀)ノ


