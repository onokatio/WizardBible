[-]=======================================================================[-]

                      Wizard Bible vol.12 (2004,9,3)

[-]=======================================================================[-]


x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x

  ---- 第０章：目次 ---

x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x

○第１章：セキュリティーキャンプ2004って結局なんだったの？

                                                      Infectionboy 著

○第２章：パスワード閲覧ソフトの仕組み                  Kenji Aiko 著

○第３章：読んで後悔するか、読まずに後悔するか　〜無線LAN編〜

                                                          IPUSIRON 著

○第４章：スパイなハードウエア                                 MaD 著

○第５章：お知らせ

○第６章：著者プロフィール



x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x

--- 第１章: セキュリティーキャンプ2004って結局なんだったの？ ---

著者：Infectionboy

x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x


■0x01.) はじめに

　今回初めてWizard Bibleに投稿させていただくInfectionboyです。
　8月の頭に暑い中（実際はクーラーガンガン）某所で行われたセキュリティキャ
ンプ2004に参加しました。そのセキュリティキャンプ2004はどういうものでなに
をやったのか？　去年やるはずだったセキュリティー甲子園とは違うの？　など
など、どんなことをやったのか気になっている方が多いかと思います。
　そこで今回はセキュリティキャンプがどのようなもので、そしてInfectionboy
自身が感じたセキュリティーキャンプについて書きたいと思います。

※ ↓↓↓ セキュリティーキャンプ2004概要 ↓↓↓
URL http://www.jipdec.jp/camp/


■0x02.) 講義の流れ。
　セキュリティーキャンプと聞いてサーバとクライアントをおいて攻撃や防御を
しあったりするものなのか？　と想像した方がいるかもしれません。しかし、実
際は違います。参加者は30名。すでに決まっている5人グループに分かれて5日間
の講義形式で行われました。女性の参加者が2人いたことにちょっと驚きました。
冒頭でも書きましたが実際はキャンプと言いつつも、施設にこもりクーラーの効
いた中で、9時〜18時、夕食後に20時〜22時とハードスケジュールな講義でした。
もちろん食事その他の休憩は間にあります。
　講義自体はあらかじめ配られていた資料を見ながら講師の方のプレゼンテーシ
ョンを受ける、というようなものでした。座学だけでなく実習もありました。講
義と実習の割合は大体半分くらいです。他に、グループ内でのディスカッション
がありました。
　さて気になるキャンプで使用したパソコンはといいますと、班ごとに7台のPCが
割り当てられてます。なにか調べ物をしたいときのための検索用パソコン2台（一
班につき）と一人1台となっています。構成ですが検索用パソコンではWindows2000
のみです。生徒用にはWindows2000にVMwareがインストールされておりゲストOSに
は、Windows2000×2、Red Hat Linux 6.2J×1、Fedora Core2×1がインストールさ
れており、外部ネットワークには検索用パソコン以外はつながっていません。ちな
みにアヤシイことができないようにしっかり講師の方に監視されています。


■0x03.) 講義内容

　主なスケジュールは次のようなものになっています。

●1日目
　・サーバとネットワーク構基礎知識
　(1)セキュアサーバ構築コスト
　(2)パケットフィルタリング設定の考え方
  (3)インストール、設定作業中の注意点
  (4)各サービスの必要性、サービスの限定について
  (5)効率的なバックアップ運用方法について
　・夕食後若手技術者との交流

●2日目
　・セキュリティと法律、ISMS、法務
　(1)不正アクセス禁止法
  (2)個人情報保護法
　(3)不正競争防止法、刑法全般
　(4)刑法全般
　(5)セキュリティポリシー、ルール、契約
　・サーバとネットワークセキュリティ
　(1)サーバとライフサイクルとコストを考える
　(2)セキュリティはサービス維持のための手段
　(3)通常監視、情報収集、予防保守と緊急対応
　(4)システムの各種ログファイルの設定と見方について
　(5)自動監視による運用コストの削減
　(5)Red Hat Linuxでの運用管理Tips
　・グループ討議
　各グループで討議テーマを決め、最終日にそれを発表する

●3日目
　・ケーススタディ1
　(1)ウイルス／ワーム感染
　(2)動作原理
　(3)外部とのデータ交換
　・SpecialSession - 牧野弁護士による講演&質疑応答
　・ケーススタディ1
　(1)感染について
　(2)ウイルス／ワーム撃退
　(3)感染しないために
　・グループ討議

●4日目
　・ケーススタディ2 - 座学「不正アクセスが発見した場合の対処法」
　(1)不正アクセス事例の紹介
　(2)事例に対する不正アクセス調査の例
　　各事例に対してどのような調査さを行ったか等
　(3)インシデントレスポンス
　　不正アクセスに遭遇したら・不正アクセス調査ガイドに従って作業
　(4)不正アクセス調査手法の紹介(基礎編) - 不正アクセスの調査の流れ
　・ケーススタディ2
　(1)実習について解説
　(2)ログ、システムステータスの調査
　(3)実習の中途解説
　(4)rootkit
　(5)フォレジック系の技術の解説
　(6)IDSの紹介
　・SpecialSession - 交流会

●5日目
　研究発表会 各グループ15〜20分


■0x04.) 講義を受けて、面白かった点・難しかった点

　今回行われた講義の中で難しかった点。.....は特にありませんでしたが、私の
場合は班の仲間たちに相当助けられたから難しく感じなかっただけなのかもしれ
ません。少し大変かなーと思ったのがWindowsからFedora Core2へのssh接続をす
るための設定でした。私はlinuxを使いますが普段sshなどを使わないので、ssh接
続の仕方を卓上では知っていても実際やってみると意外と時間がかかるなーとい
うのが感想です。周りの方を見たところ楽々にこなしている方やキー作成等で戸
惑っている方が見受けられました。他には2日目に行われたセキュリティと法律に
ついてです。普段法律なんて勉強しないので、大変でした。

　面白かったのはゲストOSに入れているWindows2000にvirusを感染させてみると
いうケーススタディーでした。さすがに家庭内ではこんなことはできないので、
参加者皆たのしんでました。他にはRedHat6.2Jを使ったインシデントレスポンス
が面白かったです。講師があらかじめクラックしておいたRedHat6.2Jを、どこに
どのようなプログラムが仕組まれたりいじられたりしたかのか等を各自で講義を
受けつつ探すというものでした。インシデントレスポンスにはddコマンドによる
ファイルシステムの複製やAutopsyによる調査など興味深いものがありました。ウ
ィルスのケーススタディーと同じようになかなか自分ではできないことなので、
面白いを通り越して興奮しました。


■0x05.) キャンプに参加して...

　正直かなりハードでした…。スケジュールを見てわかるかと思いますが、5日間
でとても濃い内容でしたので身体的に疲れるというより精神的に相当疲れました。
内容的にもLinuxを全然使ったことない方にとっては厳しかったのではないかと思
いました。Redhat6.2JによるインシデントレスポンスはLinuxを触ったことのない
人には厳しいどころではなかったのかもしれません。しかし、厳しいと言っても講
師の方々が各グループに一人ずつサポートとしてついてくださったので触ったこと
のない人でもついていけたと思います。参加者の中にはWindowsしか触ったことな
い方もいましたが、そんな方でもついていけていました。

　参加者の方が仰っていたのですが、今回「セキュリティーキャンプ」と聞いて、
多分「ぇえ！ハッキングとかクラッキング？！なにか危ないことでもするの？」
と勝手に想像してしまい参加申し込みすら行わなかった友達がいたそうです。実
は私の友達にもいました。内容は難しいかもしれませんが、「セキュリティーに
ついて学びたい！」という意気込みがあれば十分乗り切れます。「あんまりスキ
ルが高くないからなぁ〜」なんて思ってはダメです。スキルが高くないならあげ
ればいいんです。経済産業省の方が仰っていたのですが、このキャンプ自体は3年
間は最低続くそうです。また来年は募集人数を増やすようなことも仰っていまし
た。日本にはデフコンのような行事もありませんし（成人向けはあるようですが
...）、セキュリティー関係の活動があまり活発ではないと思います。そんな中に
開催され、そしてこれからも続けられていく予定（？）のセキュリティーキャン
プは唯一とまではいきませんがセキュリティに対する意識を高めそして技術を身
につけられる場なのではないかと思います。
　キャンプは技術を身につけるだけではありません。参加者30人＋講師＋5日間サ
ポートしていただくスタッフの方たちとの団体生活という人との繋がりを持つこ
ともできます。

　とても貴重な体験のできるきっかけにもなると思います。来年はみなさんも是
非応募してみてください。

※交通費、宿泊費はすべて税金から出ます。最終日閉会式後にはキャンプで友達
になった仲間たちとの秋葉原巡回もあるので地方の方には美味しいかも（笑

　これから個人的なの意見を書きたいと思います。
　今回のキャンプに参加された方はそれほどセキュリティに関心をもっていない
ような･･･なんて思いました。サーバ構築をやっている人でもあれこれやられてい
るようですが、ただそれ止まりのような気がします。セキュリティに興味がある
なら、攻撃側にも興味ある人がもっといても可笑しくない思っていたのですが･･･。
ちょっと残念でした（来年行かれる方に期待してます）。
　また、スケジュールを見てのとおりすべて防御を重視した内容となっているの
にお気づきの方もいるかと思います。私自身は防御について学ぶことはとても重
要なことだとは思います。しかし、防御しても何に対して防御しているのか、何
のために防御しているのかを意識して学べるスケジュールではなかったと思いま
す。アリストテレスの言葉に「汝の敵を観察せよ。汝の欠点を見つけるのは彼ら
だからだ」（クラッキング防衛大全より）という言葉があるように、防御をこな
すには攻撃側の手口そして心理を知り尽くしてなければならないと私は思います。
守にはまず攻撃側の視点から自分のシステムを見つめなおす。これは重要なので
はないのでしょうか。
　また、毎回キャンプ形式では参加人数にも限りがあるかと思います。いつでも
（攻撃と防御に限ったセキュリティですが）勉強できるように国レベルでのWar 
Gameサーバの設置をして欲しいと思います。このWar Gameサーバの設置は個人的
にかなり有用なものだと思います。人材発掘そして新手の攻撃方法の発見にも利
用できキャンプに参加できない人、攻撃したくてたまらないスクリプトキディー
達のハケグチにももってこいだと思います。そうすればある程度の犯罪防止にも
つながるかと（大げさですが）。
　ちなみに、アタックを練習できる無料サーバがあります。

・FHZ（http://www.hackerslab.org/jorg/hackingzone/hackingzone.htm） 
・NGSEC's Security Game（http://quiz.ngsec.biz:8080/）
・Roothack.org（http://www.roothack.org/）
・Hack3r.com（http://www.hack3r.com/）

※ セキュリティアカデメイアより引用
http://akademeia.info/main/lecture1/tuuron_kiso_hacking.htm

　講義内容には限りがあるかと思いますが、もう少し攻撃側からの視点を織り交
ぜたものを実技に取り入れてもいいかと思います。他の参加者からも同様な意見
がありましたし。何度も言うようですがセキュリティを意識する前に、どのよう
に攻撃をしかけ攻撃者の考えを理解した上での対処が必要な場面もあるかと思い
ます。なので、そこらへんを考慮したうえで来年は開催して欲しいなんて思って
います。


■0x06.) 終わりに

　後半至極個人的な意見を書いてしまいすみません。ただこのような不特定多数
の方が見ていただく所で訴えればなにか変わるかと思い書かせていただきました。
　繰り替えにしなりますが、セキュリティーキャンプは参加して損はしません。
30人という枠の狭さがありますがびびらず是非みなさん来年は参加申し込みして
ください。あなたを変えるなにかが待っています（臭っ。



x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x

--- 第２章: パスワード閲覧ソフトの仕組み ---

著者：Kenji Aiko

x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x


■0x01.) はじめに

　パスワード閲覧ソフトというものがあります。例えば、有名なもので「パスみ
え2000 1.00」があります。vectorなどで検索するとざっと4個ほどみつかります
が、キーワードを変えるともっとあるかもしれません。しかし、それらはすべて
ソースコードが公開されてなかったので、仕組みを調べようにも、どうやってい
るのか分かりません。多分、この仕組みを知りたいと思ってる人は少なからずい
るのではないか、と思い、今回の記事を書いてみました。

　実際、ものすごく簡単な仕組みなので、どこかのサイトに紹介されててもよい
と思ったのですが、検索してみると無いのですよね。もし、見つけたら、メール
（kenji@ruffnex.oc.to）へ教えてください^^;。なので、自分で書いてみました。

　ということで、今回はこのツールを実際に作ってみます。
　環境はWindowsXP + VC++.NETですが、Borland C++ 5.5.1でも確認しています。


■0x02.) 概要

　このようなツールって、とても難しいことをやっているんじゃないかな、と思
う方もいるかもしれませんが、本当は驚くほど簡単な仕組みです。実現方法はい
ろいろとあると思いますが、ここではおそらくもっとも簡単であろう方法を紹介
します。必要な技術は、マウスキャプチャーだけです。

　まずマウスキャプチャーを利用して、自分以外のWindowのハンドルを取得しま
す。パスワード閲覧ソフトを作るならば、その「****」という文字が書かれてあ
るWindowのハンドルを取得するわけです。

　そしてそのWindowハンドルを利用して、「****」というパスワードが書かれて
あるWindowへPostMessageでパスワード表示解除の命令を送信します。これで、無
事パスワードが表示されることになります。


■0x03.) マウスキャプチャー

　通常、マウスポインタが自分のWindow内にあるときは、マウスに関するあらゆ
るメッセージを受け取ることができます。しかし、マウスポインタがWindow外に
出るとメッセージを受け取ることができません。これは当たり前のことですよね。
もちろんフックなどを使うと受け取ることができますが、それはまた別です。

　マウスキャプチャーとは、マウスポインタがWindowの外にでても、メッセージ
をキャプチャーしてくれる技術です。しかしフックと違って、かなり制限があり
ますので、本格的に別のWindowに送られるメッセージをゲットして、何かをやら
かしたい場合には、フックを使うことをお勧めします。

　マウスキャプチャーについてはお馴染みの「猫でもわかるプログラミング」
（http://www.kumei.ne.jp/c_lang/sdk2/sdk_101.htm）をみてください。あと
「WisdomSoft」（http://black.sakura.ne.jp/~third/system/winapi/win45.html）
でもかなり詳細な解説がされています。
　ちなみに私はこの2つのサイトで、Windowsプログラミングを覚えました（笑）。


■0x04.) ソースコード解説

　ソースコードは以下にアップしました。

http://kenjinet.s26.xrea.com/windows/capture.cpp

　ソースコード解説としていますが、とりあえずコンパイルして実行してみてく
ださい。以下にWindowsXPのBorland C++ 5.5.1でコンパイルした例を示します。

-----
C:\>bcc32 -W capture.cpp
Borland C++ 5.5.1 for Win32 Copyright (c) 1993, 2000 Borland
capture.cpp:
警告 W8057 capture.cpp 49: パラメータ 'hPrevInstance' は一度も使用されない
(関数__stdcall WinMain(HINSTANCE__ *,HINSTANCE__ *,char *,int) )
警告 W8057 capture.cpp 49: パラメータ 'lpCmdLine' は一度も使用されない
(関数 __stdcall WinMain(HINSTANCE__ *,HINSTANCE__ *,char *,int) )
Turbo Incremental Link 5.00 Copyright (c) 1997, 2000 Borland

C:\>
-----

　警告はでますが、ちゃんとコンパイルは通るはずです。Windowsプログラムなの
で、コンパイルオプションに「-W」をつけています。では、実行してみてくださ
い。ちゃんとWindowが表示されたら成功です。

　試しに、「****」と表示されるところにマウスをドラッグしてみてください。
おそらく、ちゃんとパスワードが見えるようになるはずです。ちなみにブラウザ
に表示されるパスワード入力欄には、対応していません。

　では早速ソースコードを読んでみます。

-----
LRESULT CALLBACK WndProc(HWND hWnd,
                         UINT message,
                         WPARAM wParam, 
                         LPARAM lParam)
{
    switch (message)
    {
    case WM_PAINT:
        OpningPrintString(hWnd);
        break;
-----

　WM_PAINTメッセージが来たときの処理です。Windowに文字列を表示するための
処理を受け持つ関数OpningPrintStringを呼び出しています。

-----
void OpningPrintString(HWND hWnd)
{
    RECT rc;
    GetClientRect(hWnd, &rc);
    rc.left += 40, rc.top += 40, rc.right -= 40, rc.bottom -= 40;

    PAINTSTRUCT paint;
    HDC hdc = BeginPaint(hWnd, &paint);

    DrawText(hdc, _T(
        "このWindow領域をクリックするとマウスカーソルが変わるので、\n"
        "クリックしたまま、パスワードが書かれてある領域に、\n"
        "ドラッグしてください"),
        -1, &rc, DT_WORDBREAK);

    EndPaint(hWnd, &paint);
}
-----

　パスワード閲覧とは全然関係ない処理ですが、解説します。まずGetClientRect
でクライアント領域の座標を調べます。そして表示すべき座標を適当に決めます。
ここではそれぞれ40pxの幅を確保しています。

　次にBeginPaintとDrawText、そしてEndPaintというテキスト描画に関する一連
の処理を行っています。

　DrawTextの引数は、1番目がBeginPaintの戻り値、2番目が描画するテキスト、
3番目が描画するテキストの長さ（ですが、ここを-1にすると勝手にテキストの長
さを計算してくれます）、そして4番目が描画する領域、5番目がフラグです。5番
目のフラグは、DT_WORDBREAKとすると、適切な改行をしてくれます。

-----
    case WM_LBUTTONDOWN:
        SetCapture(hWnd);
        SetCursor(LoadCursor(NULL, IDC_CROSS));
        break;
-----

　WndProcに戻ります。ここでSetCaptureを呼びます。つまりマウスの左ボタンが
押されたらマウスキャプチャーを開始するわけです。さらにキャプチャー中であ
ることを示すためにSetCursorでマウスポインタの画像を変更します。キャプチャ
ー中ならば、自分のWindow外のマウスメッセージを取得できるので、そのままパ
スワードが書かれてあるWindowにマウスポインタを持っていってもらいます。

-----
    case WM_LBUTTONUP:
        if( GetPasswdWindow(hWnd, lParam) )
            MessageBox(hWnd, _T("GetPasswdWindow"), _T("Error"), MB_OK);
        ReleaseCapture();
        SetCursor(LoadCursor(NULL, IDC_ARROW));
        break;
-----

　マウスの左ボタンが離されたら、キャプチャーを終了します。キャプチャーの
終了はReleaseCaptureですね。SetCursorでマウスポインタの画像を元に戻します。
パスワードの閲覧を受け持っているのは、GetPasswdWindowという関数です。

-----
BOOL GetPasswdWindow(HWND hWnd, LPARAM lp)
{
    POINTS pts = MAKEPOINTS(lp);
    POINT pt = { pts.x, pts.y };

    ClientToScreen(hWnd, &pt);
    
    HWND hTarget = WindowFromPoint(pt);
    if(hTarget == NULL)
        return TRUE;

    PostMessage(hTarget, EM_SETPASSWORDCHAR, (WPARAM)0, (LPARAM)0);
    InvalidateRect(hTarget, NULL, TRUE);
    return FALSE;
}
-----

　GetPasswdWindow関数は、マウスの左ボタンが離されたときに呼ばれます。ちな
みにこの関数が実行されているときは、まだマウスキャプチャー中なので自分の
Window外のメッセージもゲットできます。つまりWindowの外、内、に関係なしに
ptにマウスの位置が入ることになります。

　ClientToScreenは、指定されたWindowのクライアント座標からスクリーン座標
に変換します。この場合の指定されたWindowとは、パスワードの文字列をもった
Windowです。そしてその座標を、スクリーン座標に変換します。

　WindowFromPointは、指定した座標にあるWindowのハンドルを戻り値として返し
ます。ここまでの流れとして、まずマウスポインタの位置を取得します。そして、
その位置をスクリーン座標に変換します。そのスクリーン座標からWindowFromPoint
を使って、その位置にあるWindowハンドルを取得します。

　そして、取得したハンドルへPostMessageでパスワードスタイルを解除させます。
最後に、そのWindowをInvalidateRectで更新します。

　これでプログラム解説は終わりです。


■0x05.) おまけ

　マジで簡単でした...(^^;
　さて、一応これで終了なのですが、おまけと題して、ちょっとした遊びをやっ
てみようと思います。

　例えば、GetWindowTextを使うと、WindowハンドルからWindowのタイトルを取得
することができます。GetPasswdWindow関数を以下のように変更します。

-----
BOOL GetPasswdWindow(HWND hWnd, LPARAM lp)
{
    POINTS pts = MAKEPOINTS(lp);
    POINT pt = { pts.x, pts.y };

    ClientToScreen(hWnd, &pt);
    
    HWND hTarget = WindowFromPoint(pt);
    if(hTarget == NULL)
        return TRUE;

        TCHAR buf[1024];
        GetWindowText(hTarget, buf, 1024);
        MessageBox(hWnd, buf, "報告", MB_OK);
    return FALSE;
}
-----

　こうして、マウスポインタをWindowのタイトルバーに当てると、他のWindowの
タイトルを取得することができます。

　GetWindowTextの他にWM_GETTEXTを使う手もあります。これを使うとエディット
ボックスに入力されている文字列なども取得することができます（でもパスワー
ドスタイルがかかってたら無理ですよ）。

-----
BOOL GetPasswdWindow(HWND hWnd, LPARAM lp)
{
    POINTS pts = MAKEPOINTS(lp);
    POINT pt = { pts.x, pts.y };

    ClientToScreen(hWnd, &pt);
    
    HWND hTarget = WindowFromPoint(pt);
    if(hTarget == NULL)
        return TRUE;

    TCHAR buf[1024];
    SendMessage(hTarget, WM_GETTEXT, 1024, (LPARAM)buf);
    MessageBox(hWnd, buf, "報告", MB_OK);
    return FALSE;
}
-----

　SendMessageでそのWindowへメッセージを送っています。WM_GETTEXTを指定する
と、そのテキストを教えてくれます。

　マウスキャプチャーは以外と面白いので、いろいろと試してみてください。フ
ックほど強力ではありませんが、シンプルなので手軽にテストができて楽しめる
と思います。


■0x06.) さいごに

　さて、いかがだったでしょうか。ホントいうと、今回はマウスキャプチャーで
はなく、別のネタを用意していたのですが、ちょっと個人的な理由により変更に
なりました。ぶっちゃけると、「スクリプト言語を作ろう」みたいなネタを書い
ていたのですが、そのために作ったプログラム（スクリプト言語）が、原因不明
のエラーに悩まされてなかなか完成しなくて...(^^;　さて、最後になりましたが
ここまで付き合って読んでくださった方本当に有り難うございました。

　では、また会う日まで...


■0x07.) 参考サイト

・「猫でもわかるプログラミング」（http://www.kumei.ne.jp/c_lang/）
・「WisdomSoft」（http://wisdom.sakura.ne.jp/）



x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x

--- 第３章: 読んで後悔するか、読まずに後悔するか　〜無線LAN編〜 ---

著者：IPUSIRON

x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x


■0x01.) はじめに

　最近は無線LAN、Bluetoothといった技術・製品が（一部で）盛り上がっていま
す。
　しかし、無線で通信されるということは、ケーブルが繋がっていません。目に
見えないので、これが不思議、気持ち悪いという人もいることでしょう。私も気
持ち悪いです。
　携帯電話のジャミングしても、ターゲットの通話がすぐに切れず（効果がある
まで30秒以上かかる）、さらに基地局の近くなどの電波が強い場所では全く効果
が無いぐらい気持ち悪いです。
　また、無線LANのジャミングを実行して、電波が出ていることを表示するNetSt
umberのメーターがガクンと下がって、「切断されました」と表示されたとしても、
所詮電波、見えないものが妨害されたとしても、一部の人しかその重大さが理解
できないし、インパクトがないので、はっきりいうと普通の人に「だからどうし
たの」と思われるのが必至でしょう。
　つまり、何がいいたいのかというと、無線LAN無線LANと騒いでも、まだまだ有
線の信仰が熱いということです。そういったことを踏まえて、ここでは無線LANの
魅力や便利さなどを言及するのが定石ですが、今回はそんなことは無視して、読
めば読むほど分からない内容を書くことにします。


■0x02.) 無線LANの規格

　無線LANといえば、IEEE802.11b/g/a（実は他にもnとかdとかたくさんある）と
いった通信プロトコルが有名です。
　「IEEE」というのは、「The Institute of Electical and Electric Engineer」
の略であり、米国電気電子技術者協会のことです。つまり、規格を策定している
ところという認識でOKです。
　それに続く「802.11」というのは無線LANの規格です。昔から「802.11」という
規格はあり（速度が遅い）、「802.11b」と発展し、現在は高速度を実現できる
「802.11g」や「802.11a」という規格が誕生しています。無線LANのセキュリティ
では、「IEEE802.11i」や「WiMAX」がホットなのですが、まず最低限、基本とな
る「802.11b」「802.11g」「802.11a」を理解しておきましょう。

●IEEE802.11b

・通信速度は毎秒11Mビット
　毎秒11Mビットというのは瞬間的な最高速度であり、実際にはデータとデータの
間に待ち時間が入るので、実効的な速度は最高で毎秒5Mビット程度。
・2.4GHz帯の電波を使用する。
　この電波対はISMバンドなので、電子レンジなどもここに含まれる。よって、無
線LAN機器の近くで電子レンジを作動させると、その間は通信速度が落ちたり、通
信そのものができなくなることがある。
　2.4GHz帯は通信以外のシステムやBluetoothなどでも使用されている。その結果、
IEEE802.11b方式には、耐干渉特性に優れた周波数拡散方式（DSSS）が採用されて
いる。
・技術が比較的枯れている。
　1999年からIEEE802.11b対応機器の販売は始まっていて、すでに6年以上もたっ
ているわけなので、製品やドライバの安定性はすでに完成されています。よって、
トラブルに対する処置などの情報も揃っています。
・互換性が高い。
　Wi-Fiにパスした製品であれば、安心して接続することができる。
・電波が比較的よく飛ぶ
　IEEE802.11b対応機器は、屋内での通信なら25〜50m程度、屋外で見晴らしがよ
ければ150mまで届く。
・ホットスポットでもつかえる。
　IEEE802.11b対応の無線LANカードを持っていれば、ホットスポットの主流はIE
EE802.11bなのでノートPCを持参して使用できます。
・伝送方式にはDSSSを採用している。
・同時に4チャンネルを使うことができる。
　1〜14チャンネルの14つありますが、チャンネル間で重複している部分があるの
で、同時に使用することができるのは1/6/11/14の4つのチャンネルだけです。

●IEEE802.11a

・通信速度は最大毎秒54Mビット
・5.2GHz帯の電波を使用する。
　5.2GHz帯は開放がされつつあり、無線LANとして使用しやすい。ちなみに、日本
では5.2GHz帯は気象レーダー、移動衛星システムなどに割り当てられていて、屋
外での利用には制限があるが、これも開放される方向に進みつつある。
・IEEE802.11bと直接には接続できない。
　混在させるには、APや無線LANアダプタに、両方の方式に対応した製品を使う必
要がある。
・電波があまり届かない。
　5.2GHz帯は障害物に弱いという特性をもつ。といっても、最近はIEEE802.11aの
無線LANチップも改良が進んでおり、電波の飛び具合もよくなってきている。
・同時に4チャンネルを使うことができる。
　34/38/42/46の4つのチャンネルがある。それらの周波数は重複していないので、
同時に4つのチャンネルを使うことができる。
・周波数選択性の歪みの影響を少なくするために、複数の狭帯域なサブキャリア
信号に分割して伝送するOFDMを採用している。

●IEEE802.11g

・通信速度は最大毎秒54Mビット
　実使用時の速度は、IEEE802.11aより若干遅い傾向にある。
・伝送方式にはOFDMを採用している。
・IEEE802.11bの互換性がある。
・機器が比較的安い。
・電波の特性はIEEE802.11bと同様。
　よって、電波が比較的よく届くが、干渉が起こりやすい。
・チャンネルがひとつ少ない。
　同時に3チャンネルまでしか使うことができない。組み合わせは1/6/11である。
・まだ新しい技術なので完成度にやや不安もある。
・2.4GHz帯の従来のシステムであるIEEE802.11およびIEEE802.11b方式との後方互
換性を持ちながら、さらに高速化してある。
・5GHz帯のIEEE802.11a方式との将来の互換性（前方互換性）を図る。


■0x03.) 無線LANの物理層の技術

　無線LANに限らず無線システムのPHYレイヤおよびMACレイヤは、適用する周波数
帯、帯域幅、使用環境、使用するアプリケーションなどに応じて、電波で最も効
率よく信号を伝送する方式を選択することが必要となる。

●高速無線伝送　＜DSSSとOFDM＞

○DSSS
・IEEE802.11bで採用されている。
・耐干渉特性が優れている。

○OFDM（Orthogonal Frequency DIvision Multiplexing、直交周波数分割多重化）
・IEEE802.11a/g、UWB、DSL、ヨーロッパのデジタル放送規格で採用されている。
　また、次世代移動通信の理想的な無線リンクとして注目されている。商用化が
可能で3Gにとって代わり得るフラリオンのネットワークは、OFDMを物理層とMAC/
リンク層のソリューションとして使用している。
・多数のユーザーが通信チャネルを共有できるように、チャネルを分割する変調
と多重アクセスの方式。
・TDMAは時間、CDMAは拡散符号で分割するが、OFDMは周波数で分割する。
・マルチパス・フェージング、遅延スプレッド、ドップラーシフトのような無線
チャネルの問題に強いために、多重アクセス技術の実現が可能である。
・マルチキャリア伝送方式の一種
　波の重ね合わせの原理により、直接波と反射波が合成されるとき、両者の位相
が揃えば合成波電力は大きくなり、位相が異なれば（逆相であれば）打ち消しあ
って合成波電力は小さくなる。この結果、広帯域なシステムでは、周波数選択性
の歪みが発生する。この周波数選択性の歪みをなくす方法が、複数の狭帯域信号
に分割するマルチキャリア方式である。狭帯域信号に分割することで、ひとつひ
とつのサブキャリアの周波数選択性歪みがなくなる。また、時間軸上で考えると、
狭帯域化することによって、相対的に反射波の遅延時間が短くなり、影響が少な
くなる。
・複数のサブキャリアを周波数軸上に直交条件を満たすように（位相を90度離し
て）、密に配置する。サブキャリアを配置・合波するアルゴリズムには、IFFT（
Inverse Fast Fourier Transform、逆高速フーリエ変換）が用いられる。
・サブキャリアを密に配置できるから、高い周波数利用効率が得られる。
・マルチパス伝搬による周波数選択性フェージングが原因でおこる波形の歪みに
対して、強い耐性を持つというメリットがある。
　例えば、シングルキャリア伝送の場合、フェージングの結果、受信波形の歪み
が激しくなってしまう。この歪みを補正するには等化器（イコライザ）を使用す
る必要があり、回路が複雑になってしまい大規模になる問題がある。一方、マル
チキャリア伝送（OFDM）の場合、ひとつひとつのデータの歪みが小さく、レベル
の低下のみで押さえることができる。レベルの低下、即ちS/N比の劣化は、事前に
伝送データに誤り訂正符号化とインターリーブを施すことによって補完できる。
・ガードインターバルの挿入。
　多重波による符号間干渉（ISI）の影響を軽減するために、それぞれのシンボル
にガードインターバル（GI：Guard Interval）と呼ばれる冗長信号が挿入される。
　多重波は、直接波以外に多くの遅延波（周辺の物体に反射して届く電波）を含
んでいる。受信側でそれぞれのサブキャリア信号を分波する際に、単純にFFT（高
速フーリエ変換）してしまっては、遅延波が含まれるからうまく分波されない。
これを解決するために、OFDMシンボルの後端部分を先端部分にコピーして、信号
が周期的に連続になる巡回的な構成にするのがガードインターバルである。
　ガードインターバルによって、受信側でFFT処理を行う際に、マルチパスによる
遅延波が信号に含まれていても、ガードインターバルの範囲内であれば、正常に
FFTによって分波できるのである。
　例えば、IEEE802.11aは、ガードインターバルを800ns（ナノ秒）と規定してい
る。これは、自乗平均値（RMS）で100〜200nsの遅延分散のある大規模なショッピ
ングモールや工場などの環境にも適用できる設定である。
・誤り訂正との親和性が高く、両方を用いることで高品質を達成できる。誤り訂
正には畳み込み符号化−ビタビ復号方式を採用している。
・OFDMは、誤り訂正の符号化に「畳み込み符号化」を使い、復号には「ビタビ復
号」を用いる。
・誤り訂正の符号化率は1/2、2/3、3/4の中から選択される。つまり、可変。
・畳み込み符号化−ビタビ復号器は、拘束長7、符号化率1/2の符号を基に、パン
クチャード符号化によって符号化率2/3および3/4を実現している。
・パンクチャード符号化は、送信側では符号化率1/2で符号化された信号の中から
一定規則でビットを削除（パンクチャー）する。これによって、源信号とビット
を削除した後のデータの比率から、符号化率2/3あるいは3/4の符号器に相当する
ことになるのである。受信側では、削除されたビットに相当するダミービットを
挿入して、ビタビ復号器に入力されてもとのデータが復号される。ただし、ダミ
ービットは受信信号ではないから、そのタイミングに相当する確からしさ（メト
リックという）は、いずれの受信信号に対しても中立な値として判定に使われず、
前後の信号のメトリックから判定される。このように、ビタビ信号は、畳み込み
符号化されたデータ列として最もふさわしいデータ列を推定する方法なのである。


■0x04.) アクセス制御

　アクセス制御とは、複数の端末がデータを送信する時の競合の制御方法である。

●分散制御

　分散制御には全端末を制御する無線局がないので、それぞれの端末が必要なと
きに電波を送信するCSMA方式が適している。802.11の無線LANは、元々有線LANの
802.3で用いられるCSMA/CDの系統であり、802.11b/a/g共にCSMA/CAを基礎として
いる。
　このように信号の衝突を前提とした制御方式をDCF（Distributed Coordination
 Function、自立分散的アクセス制御）と呼ぶ。

●集中制御

　802.11は、DCFの他にもオプションとしてPCF（Point Coordination Function、
集中制御によるアクセス制御）も定義されている。これはAPがポーリングによっ
て制御を行うから、端末の信号が衝突しない。
　そして、集中制御型を前提とするTDMAを用いる無線LAN方式には、HiperLAN/2と
HiSWANaがある。TDMA方式にはQoS制御が可能であるという長所がある。

[補講]ポーリングとは、端末に送信信号の有無の確認を順次行い、「送信信号あ
り」の応答のあった端末に送信権を与える方式。


■0x05.) 干渉の解決

　他のシステムと干渉することなく無線で通信を行うには、他の通信と次のいず
れかが異なっている必要がある。
・場所
・時間
・周波数
　この3つをリソース（resource、資源）と呼ぶことがある。

　ただし、ここではCDMAのように符号で分割することは考えない。

　APが複数の端末と通信する無縁LANでは、APの場所・周波数が固定的に決定され
るので、それぞれの端末が異なる時間に通信を行うことが必要になる。

　複数の信号が、場所・時間・周波数の一致で干渉し、信号のうちひとつ以上が
通信に使えなくなる状態をコリジョン（collision、衝突）と呼ぶ。

●アクセス制御方式

　アクセス制御方式とは、それぞれの通信にリソースを割り当てて通信を制御す
ることである。
　アクセス制御には次の2種類がある。
・衝突を前提にする競合型
・衝突をなくす非競合型

○競合型

・TDMA方式、ポーリング方式
・HiperLAN/2やHiSWANaはTDMA方式を用いており、802.11のPCFはポーリング方式
を採用している。
・端末のバッファに送信信号がある場合などに、何らかの条件を満たせば送信を
行う。
・競合型アクセス制御の最も単純な方式がALOHA（アロハ）方式である。これは、
送信が必要になれば条件無しに送信を行う。STA（Station、端末）数が少ない場
合は効率的であるが、端末数が多くなるにつれて衝突が起こって非効率になり、
スループットが低下する。
・802.11のDCFは、競合型の中でも衝突が少なくできるCSMA/CA（衝突回避機能付
きキャリア感知多重アクセス方式）を採用している。

○非競合型

・APなどの制御局が割り当てた時間にそれぞれの端末が信号を送信する。

●CSMA/CA

　CSMA/CAの仕組みは次のようになる。

　送信が必要になった無線局はまず他の局が通信中であるか否かを判断して、通
信中で無いという条件が満たされれば信号の送信を開始する。通信中であるか否
かの判断のために、キャリアセンスを行う。キャリアセンスとは、送信しようと
する周波数でキャリア（通信に使用されている電波、即ち搬送波）がセンス（感
知）されないときは未使用（Idle、アイドル）であると判断して送信を開始する。
　このとき、センスの判断基準の受信レベルをキャリアセンスレベルと呼び、干
渉無く通信ができる値が設定される。例えば、802.11aのキャリアセンスレベルは
-62dBmである。
　一方、キャリアがセンスされたときは、他の局による通信中（Busy、ビジー）
であると判断して送信待機状態になる。送信待機時間が完了してから最低限の送
信信号間隔（IFS：Inter Frame Space）に続き、バックオフと呼ばれる時間キャ
リアセンスを行い、その間継続してアイドルであれば送信権を得て送信を開始す
る。
　送信時間は、アイドルになってから、キャリアセンスした際に受信したフレー
ムのデュレーションフィールドに書かれている送信禁止期間が終了するまでの時
間である。通常のデータフレームの場合、送信禁止期間はNAV（Network Allocat
ion Vector）と呼ばれ、SIFS（Short IFS）時間とACKフレーム長の和となる。

◎IFSについて
　IFSは、送信信号によって優先制御を行う仕組みである。同時に送信待機状態に
ある複数の端末の中では、有線順位が高くてIFSが短い端末でなければ送信権を得
ることができない。
　IFSの時間長を優先度の高いものから分けると次のようになる。
1：SIFS（Shoft IFS）
2：PIFS（PCF IFS）
3：DIFS（DCF IFS）
4：EIFS（Extended IFS）

　通常の信号を送信するには、DIFSを用いる。
　最も優先順位が高いSIFSは、データフレームを正常に受信した際に返信される
ACKフレームの送信前に用いられる。なぜならば、ACKフレームは、その前のデー
タ送信から続く一連の信号であることから、早く送信して送信を完了させるため
に優先するのである。
　PCFモードではPIFSを用いる。PCFの信号をDCFよりも優先することによって、
DCF期間中にPCF時間が割り込み、DCF/PCFの制御時間を分離して運用できる。
　EIFSはビジーの原因がフレーム受信エラーの場合に用いる。この場合、デュレ
ーションフィールドを読み取ることができないから、「SIFS時間＋ACKフレーム長
＋DIFS時間」に相当するEIFSを用いる。

　IFS時間の終了後には、バックオフと呼ばれる処理が行われる。バックオフとは、
同じ優先順位にある複数の端末がIFS時間の後に同時に送信を開始することによる
衝突を回避する仕組みである。IFS時間後、それぞれの端末はCW（競合ウィンドウ）
というランダムな遅延時間の範囲内の乱数を発生して、その値に従ったランダム
バックオフ時間後に送信を開始する。

●RTS/CTS

　以上のIFSとバックオフはキャリアセンスによって、衝突が回避できることを前
提としている。しかし、場合によっては端末間に遮蔽物があり、キャリアセンス
が症状に動作しない状態、つまり隠れ端末問題のときがある。802.11では、この
隠れ端末問題の影響を防ぐためにRTS（Request to Send、送信要求）/CTS（Clear
 to Send、受信準備完了）を用いている。

　RTS/CTSの仕組みは次のようになる。

1：端末AがAPに対してRTSを送信する。

2：APはこれを受信した後に、CTSを送信する。

3：実は、RTSとCTSには、デュレーションと呼ばれる無線回線を使用する予定時間
が示されている。これによって、ディレーション時間の間は端末Aに占有されるわ
けである。
　他の端末はCTSに示されているデュレーションを読み取り、その間はキャリアセ
ンスによらず送信を行わない。この送信が禁止されている時間をNAVと呼ぶ。

■0x06.) 各方式の使い分け

●PCの台数による使い分け

　無線LANは接続する台数が増えると、それに反比例する形で通信速度が落ちてい
きます。
　よって、多数のPCを無線LANで利用するならば、IEEE802.11a/gが向いている。

●安定した通信が必要な場合

　IEEE802.11b/gは2.4GHz帯を使うため、周囲に2.4GHz帯を使う機器があると、通
信が不安定になってしまいます。特に、工場や病院では、2.4GHz帯を使い機器が
周辺にあることが考えられます。
　よって、このような場面ではIEEE802.11aが向いている。

●互換性が必要な場合

　一番普及しているIEEE802.11bに対応しつつ、コストを安く押させながら通信速
度を高めるためにIEEE802.11gを選択するという手もある。ただし、IEEE802.11b/g
を共存させることで、IEEE802.11ｂに足を引っ張られてIEEE802.11g本来の力が発
揮できないデメリットもある。それが気になる場合は、IEEE802.11g/aに対応して
いるAPを用意するとよい。

●電波を長距離飛ばしたい場合

　広いオフィス、階をまたいで無線LANを使う場合は、電波がより遠くに飛ぶ方式
を選択すべきです。そのような場合、IEEE802.11b/gが適しています。

●ESSIDでグループ分けする場合

　一台のAPで複数の無線LANクライアントを処理しようとすると速度が低下します。
そのような場合は別々のESSIDをつけた複数のAPを設置するとよい。

●複数のチャンネルで干渉を防ぐ場合

　無線LANでは2.4GHzや5.2GHz帯の電波を使いますが、周波数には幅があり、その
幅をいくつかに分けるようになっている。その分かれたひとつひとつがチャンネ
ルである。学校や企業といった台数がかなり多い場合は、複数のAPを設置してそ
れぞれ異なるESSIDを設定することで負荷を分散させます。しかし、近くに同じチ
ャンネルを使用するAPがあると、電波が干渉して速度の低下が発生します。この
場合は、異なるチャンネルを設定することで電波の干渉を防ぐことができます。
　IEEE802.11b/gはそれぞれ4つのチャンネル、IEEE802.11aは3つのチャンネルが
使用できる。よって、IEEE802.11a/g両対応のAPを使い、無線LANアダプタも両対
応のものにしておけば、7（＝4+3）つのチャンネルが使用できる。


■0x07.) PoE

　PoE（Power over Ethernet）は、Ethernetケーブルで電力を供給して、ケーブ
ルを1本で済ませようという方法です。

●PoE用のケーブル

・Ethernetケーブルのコネクタには端子が8つあるが、10BASE-Tおよび100BASE-TX
のLANではそのうち4つまでしか使いません。PoEは残りの4つの端子を使って、電
力を供給する仕組みになっている。従って、8つの端子が全て接続されているEth
ernetケーブルが必要となる。
・カテゴリ5以上（カテゴリ5、エンハンスドカテゴリ5、カテゴリ6）に対応して
いる必要がある。

●利用場面

　天井にAPを設置する場合、電源コードが届かない可能性があり、延長コードを
使ったとしてもスマートでない。こんなとき、PoEを利用するとすっきりする。

●接続例

　エレコムのLD-WLS55AG/APはデフォルトでPoE接続用のアダプタがはいっていま
す。

1：PoEアダプタにACアダプタを接続して、それをコンセントに差し込む。

2：PoEアダプタの「DATA IN」のコネクタに、有線LANからのEthernetケーブルを
接続する。

3：PoEアダプタの「P+DATA OUT」のコネクタに、LD-WLS55AG/AP付属のEthernetケ
ーブルを接続して、その反対側をLD-WLS55AG/APに接続する。


■0x08.) 複数のチャンネルを使う

●IEEE802.11bにおけるチャンネルの組み合わせ方

====================
番号 | 組み合わせ方
--------------------
1    | 1,6,11,14
--------------------
2    | 2,7,12
--------------------
3    | 3,8,13
--------------------
4    | 4,9,14
--------------------
5    | 5,10,14
====================

　IEEE802.11bの場合、全てで14のチャンネルを設定できる。チャンネル間で電波
の周波数帯域が重なっている部分があるので、番号1〜5のいずれかを利用するこ
とになる。1,6,11,14の組み合わせだと、4つのチャンネルを同時に使えるので、
一般的にはこの組み合わせ方が一番よく使われる。

●IEEE802.11gにおけるチャンネルの組み合わせ方

====================
番号 | 組み合わせ方
====================
1    | 1,6,11
--------------------
2    | 2,7,12
--------------------
3    | 3,8,13
====================

　IEEE802.11bと似ているが、14のチャンネルがないので、同時につかえるのは最
大3つのチャンネルということになる。


■0x09.) ローミング

　無線LANクライアントが動いても接続が維持されるような仕組み。ローミング機
能を有効にするには、複数台のアクセスポイントを有線LANに接続して、なおかつ
全てのアクセスポイントのESSIDを同じに設定する。そして、個々のアクセスポイ
ントが非常に離れていて、電波の混信する恐れがなければ、各アクセスポイント
のチャンネルを同じにしても構わないが、一般的に電波の混信の可能性があるの
で、近くのアクセスポイント同士のチャンネルは異なるようにする。ローミング
を使う場合の注意として、アクセスポイントの互換性がある。全て同じアクセス
ポイントで統一すれば問題ないが、他の製品を混在させると、ローミングがうま
く働かないことがある。


■0x10.) ロードバランス機能

　ロードバランス機能とは、自動的に負荷を分散する機能のことです。対応して
いる製品を使えば、特定のAPに通信が集中しそうになると、自動的に他のAPに通
信が切り替わるようになる。現状では、高機能かつ高価格のAPに付属している機
能です。


■0x11.) 終わりに

　まだまだ触れたいことはありますが、今回はこのぐらいで止めておきます。
　次回はもっとわけがわからなくなるので、来月までに理解しておいてください
ね（嘘）。

　体系的に理解したければ、次の講座を読んだほうが2^10倍役に立ちます。

http://akademeia.info/main/lecture1/tokubetu_musen_lan.htm



x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x

--- 第４章: スパイなハードウエア ---

著者：MaD

x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x


■0x01.) 無線LAN侵入における「見た目」の問題

　あれは数年前のこと、知り合いが無線LANカードを装着したノートPCを開き、新
宿の街中でNet Stunblerを使いスキャンをかけていた。その光景を見ながら「ス
キルがあってもハードがそれじゃ丸分かりだろ……パクられるよ」と思った。

　無線LAN侵入において、ハイレベルな侵入目的ではない限り、その多くの目的が
ツールで事足りるといっても過言ではない。無線LAN侵入での問題点はセキュリテ
ィの甘い現状からするとハードウエア面での問題が大きいと思える。
　とくに無線LAN侵入といえば、WEP解析がキモになると思うが、実際に試してみ
てゲンナリした。セキュリティアルカディアでも紹介されてはいるが、キャプチ
ャーにかかる時間を考えると、WEP解析は現実的な方法だとは思えない。さらに、
WEP+、WPAなどかけられているとさらに萎えてしまう。
　つまり「WEP解析は出来ないもの」と考えてWEPのかかっていないアクセスポイ
ントのみを狙う方が賢い選択だと思える。実際、WEPのかかっていないアクセスポ
イントはいくらでもあるからだ。
　そうした意味で「WEPのかかっていないアクセスポイントのみを狙う」というこ
とをテーマにして、話しを進めてみる。


■0x02.) ハードウエア面での問題

　まずは、ハードウエア面での問題を挙げてみる。

　・ノートＰＣでは小さくても目立つ
　・無線LANカードが挿さっているため目立つ

　このようなハードウエア環境では「それをやっている」ということが相手に分
かってしまう。たとえば、ある企業のビルの前でスキャンをかけたとする。どう
しても画面を見る必要がある。War Drivingをしながら車内でスキャンをかけてい
るならともかく、歩きながらではどう見ても不自然だ。
　また、スキャンをかける場合、必要な場面ですぐにできなければ意味を持たな
い。どんな状況でも動ける体制でありたいのは誰でも同じことだろう。
　つまり、無線LAN侵入で鍵を握るのはハードウエアという要素が非常に大きい。
こうした行為を実行する場合「スパイ大作戦」や「007シリーズ」のようにいかな
いものかと考え、そのことをテーマにして優秀な小型のハンドヘルドPCを探して
みた。　「その瞬間がきた」というとき、すぐに目的を一台だけでスマートにプ
ロセスを達成できる機材でなければならない。よって、ある程度のタイピングが
可能な「フルキーボード装備」であることを条件とした場合、次の機種が候補に
上がった。

●Zaurus SL-C860
　（www.sharp.co.jp/products/slc860/index.html）
　→120mm（W）×83mm（D）×23.2mm（H）　250g
　→バッテリー動作：8時間30分

●Sigmarion3
　（www.nttdocomo.co.jp/info/products/sigmarion3/）
　→189mm（W）×117mm（D）×21mm（H）mm　455g
　→バッテリー動作：8時間

　ここまでは妥当な線だと思う。こうしたモバイル機器で一番気になる点が「大
きさ」「重さ」「動作時間」である。そうした意味からすると「Sigmarion3」は、
大きくて重いためすぐに消えた。「Sigmarion3」が消えるということは、このあ
たりの大きさの機種はすべてダメだということになる。ワイシャツのポケットに
入る程度の大きさでなければならない。そうなると「Zaurus SL-C860」だ。Linux
（OpenPDA）をOSとしている点ではもっとも注目されている機種だ。いずれの機種
もカメラや無線LANをカードで追加するという点は同じだ。そこが見た目と値段で
少し不満が残る。
　そうした中、昨年秋にSONYからフルキーボードを搭載したCLIEが発売された。
「SONY」とメーカー名、また「CLIE」という製品にかなりの抵抗があった。PCヲ
タとしては「自爆装置内蔵のSONY製品てどうなのさ〜？」といった先入観を持っ
ていた。だが、スペックだけは一応見てみることにした。

●CLIE PEG-UX50
　（www.sony.jp/products/Consumer/PEG/PEG-UX50/）
　→103mm（W）×86.5mm（D）×17.9mm（H）mm　175g
　→バッテリー動作：14日

　「大きさ」「重さ」については文句なし。この手の機種は、どれも機能に大差
はないように思える。かなりイケてるスペックだ。特にエレガントなルックスが
気に入った。
　そして、商品説明を読んでいくと、ワイヤレスLAN（IEEE802.11b）とBluetooth、
そしてデジタルカメラからムービー関連の機能もすべて標準で内蔵していること
が分かった。これはズバ抜けている。絶対に買おうと思った。
　そんな中、じゃんぱらで箱なしの中古のものが３万円弱で売られていたので、
清水の舞台から飛び降りて、そのまま頭がい骨陥没で死んだ気持ちで購入した。
ちなみに新品価格で６万円前後、オークションでは４万円台が相場となっている。
新宿界隈で空き缶を拾うならば３万本の差がある。これはデカイ。


■0x03.) CLIE PEG-UX50使用報告

　実機を触り、胸のポケットやジーパンのお尻のポケットにも収まるほどのコン
パクトな大きさであることにあらためて驚いた。さらに設定によってはキーボー
ドのキーの部分を光らせることもできる。暗いところで使う場合には便利な機能
だ。ただ、キーボードのキーは最強に押しにくい。早打ちは難しいだろう。キー
タイピングはSigmarion3に軍配が上がる。それ以外については文句なしだ。

　さて、問題の無線LANだ。まずはMini Stunblerをインストールしようと思った
のだが、この機種には対応していないことを知った。かなり焦りつつワイヤレス
LAN設定を起動してみると「スキャン」というボタンがあったので押してみた。

　するとスキャンが開始され、数秒後にAPを検知していた。WEPがかかったAPには
「*」のマークがついているので、そのマークがついていないところが簡単に接続
できるということになる。

　最初のスキャンで「YBBユーザー」というのが見つかった。しかもWEPがかかっ
ていない。さすが「YBBユーザー」というだけのことはある。反面、ハニーポット
を仕掛ける場合、国内では「YBBユーザー」とすると食いつきがよいことになると
も思えた。
　簡単に接続でき……たことだろう。ただ、YBB関係には一切かかわりたくないの
で接続はしなかった。
　次に表に出て向かいのマンションの前でスキャンをかけた。やはりWEPなしが見
つかった。AirMacとBase Stationを使っているユーザーであることが分かる。

　他、新宿都庁付近では数10メートルおきにAPが腐るほど見つかった。都庁も無
線LANを導入しているということなので今度、実験してみたいと思う。
　このように、新宿に住んでいる限りでは、APが異なるものの、いつでも無線LAN
で接続ができることが分かった。
　また、問題の「見かけ」なのだが、この手のサイズの機器になると単にゲーム
をしている程度にしか見えない。道行く人は誰も気にしないで通り過ぎていった。


■0x04.) 全体の機能

●アプリケーション登録ボタン

　この機種は画面を回転させて畳むこともできる。その際、わずかにはみ出たと
ころに３つのボタンがあり、そこに任意のアプリケーションをアサインしておき、
そのボタンを押すだけで電源が入り、任意のファンクションに入ることができる。
当然、ひとつをワイヤレスLANに設定している。これでここぞという場面で一発で
起動、あとは画面の「スキャン」というボタンを押すだけだ。スキャンは長い場
合、30秒程度の時間はかかるが、そんなに気にならない。実際の接続は環境にも
よるが遅くて１分程度、これはビルの外から手当たり次第に接続する場合だ。目
の前にAPがある場合は10秒もかからずに完了する。

●キャプチャーボタン

　もともとマルチメディア系にも強いということがコンセプトなので、本体の後
部についているカメラで動画、静止画を撮影できる。これもわずかにはみ出たと
ころに専用ボタンがあり、それを一度押せば電源が入り、すぐに撮影状態になる。
再度押せば撮影ができる。たとえばスキャンして出てきたWEPなしの建物を撮影で
きる。こうして名前をなんらかの形で一致させておけばAPをイメージでとらえる
ことができる。しかも動画もオッケーなのだから申し分ない。画素数は31万画素
と低レベルだが、ウエブなどで使う程度であればなんとか使える。また、カメラ
のレンズは回転するため角度調整が自由にできる。スパイグッズとしては十分な
機能だといえる。

●バッテリーの消費量

　こうしたモバイルツールにおいて重要な点は「バッテリーの消費量」だ。いく
らスゴい機能があろうとバッテリーの消費量が激しい機種は使えないも同然と考
えている。たとえば、現在、テレビが見れる携帯電話が登場しているが、バッテ
リーの消費量を考えるとネタであるとしか思えず「バカが買うんだろうな」と冷
ややかな目で見ている。
　本機は、使用するソフトによりCPUの動作が異なるため、その消費量はまちまち
だ。たとえば、一日中、無線LANのAPをスキャンした場合でも一日でバッテリーが
切れることはない（但し、ずっとネットに接続している場合は２時間程度）かなり
バッテリーのもちもいい部類に入るかと思う。
　また、専用の予備バッテリーを購入すると３倍ももつということだが、現状で
不満を感じないため、まだ購入していない。

●テキスト

　PCヲタとして、帰郷などで新幹線の車中で原稿を書いたり、インターネットや
電子メールを使いたいためにノートPCを色々と買ったのだが、一度も使った試し
がない。一番の理由は「周囲の目線が痛い」という点だ。この機種ならゲーム（
ゲームボーイアドバンスSPなど）をしているようにしか見えないため十分に許容
範囲内だ。また、文字入力はよくある「手書き」から「ソフトキーボード」など
備えているが、本体キーボードだけで十分だ。PCでのタイピングと比較するとキ
ーの反応が劣るため非常にモタつく。ペコンペコンといった反応になる。しかし、
慣れてくると苦にはならなくなった。IMEは標準で「ATOK」が入っているため変換
も問題ない。辞書登録なども可能だ。使い方もPCとほぼ同じなので違和感を感じ
ることなくおこなえる。

●ショートカットとアプリケーション

　ショートカットも必須とされるものはPCとほぼ同様で、コピー（C）、ペースト
（V）、全てを選択（A）、アンドゥ（Z）など「Control＋キー」で、アプリケー
ション間でも利用できる。筆者はショートカットを多用するため非常に便利に使
えている。OSはPalm OS5（Ver.5.2）日本語版なのでPalmOSのアプリケーションが
使える。ウエブブラウザは「Net Front（Ver.3）」、メールクライアントは「CLIE
 Mail」となっている。FTPクライアントは標準ではインストールされていないが
「DataDive!（Ver.2.71）」などをインストールすれば問題ない。ほか、画面のキ
ャプチャーソフトもシェアウエアで配付されているため仕事でも使えそうだ。


　以上、簡単に機能を紹介したが、いつもは時間ができると携帯電話に手が伸び
たわけだが、本機を手に入れてから携帯電話を触る機会が減った。また、昼食ど
きも、いつもは本を持って食事にいっていたが、現在では本機だけを持っていく
だけの習慣がついてきた。会社の向かいのビルにあるお洒落な喫茶店でPowerBook
 G4を開いてネットに接続しているお姉さんを見かけたが、古くさく感じてしまっ
た。本機はネット接続においても、それくらい使えるものになっている。
　また、JR東日本が試験的に駅での無線LAN接続サービスを始めたようだ。プロバ
イダのIDとパスワードさえあれば利用できるようなので、普通の使い方、悪い使
い方、いずれも便利になるだろう（ただし、SSL）。

※無線LAN接続サービス
http://www.jreast.co.jp/musenlan/


■0x05.) 無線LANの不正使用と法律問題

　ここから法律問題について紹介しておく。
　もちろん、無線LANを用いて許可されていないAPへの接続は、電波法や不正アク
セス禁止法案に抵触する。だが、一般的に販売されている機器を普通に使っただ
けでこうしたことができるのだから、そこはどうなのかと思う。そうした知識の
ない者が見知らぬAPでインターネットに接続できた場合「すごーい！　便利ー！」
とかいいつつ、そのまま使うだろう。

　過去、無線LANを用いて不正アクセスをおこなった容疑者が逮捕された事件があ
ったので、それをモデルにしてみると、この逮捕は「War Drivingで同じAPばかり
を利用していたため事件が発覚して逮捕された」となっている。また「War Driving
が原因で逮捕された」ということではなく「不正アクセスに関する取り調べの過
程でWar Drivingをしていたことが判明」となっている。ここが重要なのである。
　自分もこうした場合のＫ事の取り調べ手順と、Ｋ事のできることの限界を知っ
ているが、まさしくその通りだ。一般のＫ事の多くは、プリンターの設定すらま
まならないのが実情である。


■0x06.) 無線LAN APアダプターによる犯罪の可能性

　近年では社内ネットワークを組んでいる企業は急増している。特にケーブル接
続（10/100BASE-T）の企業はまだまだたくさんある。データハウスでも無線LANは
使用しておらず、すべてがケーブル接続だ。これは、担当者がスキルがないため
の苦肉の策だといえる。しかし、これも危険であることに気付いた。
　ケーブル接続の場合、会社の中では少なからずどこかの場所にLAN用のHUBを置
いているはずだ。データハウスでも何台あるのかわかならないくらい置いてある。
　LAN用のHUBとなると、当然ACアダプターが必要なため付近に電源があるはずだ。
この場合、設定を済ませた無線LANAPアダプターとLANケーブルと二股のACタップ
を用意しておき、そこに仕掛ければ情報を覗くことも可能であり、また、不正ア
クセスをおこなう場合の拠点にすることもできる。
　もちろん、この場合、MACアドレス、WEPは自分の設定にしておくことが重要だ。
つまりセキュリティを高めることにより、他人が無線LANAPアダプターにアクセス
できないようにするわけだ。スキルのある者が、ある踏み台を見つけて、他の者
を侵入させないためにセキュリティレベルを上げるといった話と同じことだ。
　知識のある管理者などがいる会社ではすぐに発覚してしまう可能性があるが、
データハウスのような会社ではヘタをすると10年くらい発覚しないままで使われ
る可能性がある。
　しかし、これが発覚したところで数千円の損失だけで済み、自分を特定するこ
とも難しいといえる。また、重大な事件でない限り指紋など調べないこともつけ
加えておく。

　以上、お気に入りの機種を紹介したが、いずれにしても知識を持たないコギャ
ルがこの機種を持っていたとしたら渋谷センター街のAPは不正アクセスの拠点に
なる日がそこまできている。プ

　んなわけで、慌てて書いた3762回目のクソ原稿はおしまい。

　次回くらいで、詐欺師まどさんのプライドを傷つけた「実録・オークション詐
欺師の追い込み」を紹介します。



x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x

 --- 第５章：お知らせ ---

x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x

○Wizard Bible（http://akademeia.info/wizardbible/）では随時、執筆ライタ
ーを募集しています。
　扱う内容のテーマは広義での「under ground」です。例えば、ハッキングから
サリンガスの合成法などと幅広い内容を考えています。また、各種、特殊な職業
や趣味を持った方のレクチャーなども含まれます。
　一回きりでも構いません。また、必ず、毎回連載する義務もありませんのでで
きる範囲で構いません。気軽に声をかけてください。もちろん一回書いたことが
ある人も気軽に声をかけてください（全く気にしていない性格なので）。

○Kenji AikoさんがQ&Aを作ってくれました。初めて参加する人でもわかりやすく
書かれていますので、参考にしてください。

http://akademeia.info/wizardbible/wbQandA.html

○支援者、参加希望者用のスレッドを立てました。

http://ruffnex.oc.to/ipusiron/cgi/forum/patio.cgi?mode=view&no=17



x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x

  ---- 第６章：著者プロフィール ---

x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x

　今回は各著者にこだわりの外部入出力装置を紹介してもらいました。

■Infectionboy
●Job:Student
●Web:- 
●Mail:秘密
●Team（Group）:
●Comment:
　思い切って投稿してみました。ところどころ変なところもあるかもしれません
が最後まで読んでくださった方どうもありがとうございますm(_ _)m。大学生くら
いになったら資金とスキルそして時間の許す限りWarGameサーバを立てたいとおも
っています。そのときは皆さん遊びに来てくださいね＾＾
●こだわりの外部入出力装置：
　こだわっているものは特にないのですが、お気に入りのキーボードを紹介しま
す。
http://www2.elecom.co.jp/products/TK-U12FYLBK.htmlです。
ロングケーブルというのとすべて青色LEDというのに惹かれて買ってしまいました。
青色LEDはイイですよー！かっこいいです。でも少し打ちにいくいような･･･。HHK
が欲しいのですが高校生にはちょっと高いですね。

■Kenji Aiko
●Job: Student
●Web: http://ruffnex.oc.to/kenji/
●Mail: kenjinet@s26.xrea.com
●Team（Group): N/A
●Comment:
　前回の記事で、この次こそはLinuxネタでいこうと思ってます、とかいっておい
て、またまたWindowsネタになってしまいました(^^;。いや、ちゃんとLinux用の
やつを書いていたのですが、ちょっといろいろとトラブルが...ごめんなさい(--;。
●こだわりの外部入出力装置：
　特になし（笑）。ごめんなさい、ハードウェアにはほとんど興味がないです。というよりも、ほとんど知識がありません。ソフトウェア限定な人間です。

■MaD
●Job:DATA HOUSE
●Web:http://www.data-house.co.jp/
●Mail:mad@data-house.co.jp
●Team（Group）:h@cksection,ruffnex
●Comment:
　元ハカージャパソと危ない28号の百円ライター。趣味は、空き缶拾いと牛乳瓶
のフタ集め。２ちゃんねるでは「矢崎マサユキ」、「白鶴・丸」、「大同曲芸人
」、「泥棒・詐欺師」として通っている。ウソばかりつくので友達はいない。
　現在は会社でヒッキーをしているが、将来はネットカフェの店員なるという目
標に向かってまっしぐら。とぁっ！(`Д´)。
●こだわりの外部入出力装置：ひみつ


■IPUSIRON
●Job:サイト更新
●Web:- Security Akademeia -（http://akademeia.info/）
●Mail:ipusiron@ruffnex.oc.to
●Team（Group）:TeamSA,ruffnex
●Comment:
●こだわりの外部入出力装置：PC切り替え器「PShare」
　PC切り替え機は外部入出力装置とはいえないけど、外部入出装置とPCの間に介
在するので、例外として取り上げます。
　PShareは、ぷらっとホームで販売されているPC切り替え器です。通常のPC切り
替え器と比べると高価な部類に入りますが、次のような特徴を持つ。
・キーボードから切り替え可能
　[Ctrl]+[Alt]+[Alt]→[数字]→[Enter]、または[Ctrl]キーを2回連打、または
[Scroll Lock]キーを2回連打すればよい。
・ラックマウント可能
・カスケード接続で最大16台のPC接続可能
・接続の常時抜き差し可能
　これは安物PC切り替え器にできないPS/2エミュレーション機能により実現する。
・上位バージョンはDOS/V互換機以外のMacintosh、SunOSにも対応している。

　PCが増えるたびにキーボードとマウスで無駄に面積を占めてしまう問題を解決
してみませんか。椅子を動かすことなく、全てのマシンを操作できるのは快感で
す。

http://online.plathome.co.jp/products/pshare/pshareex/price.html
