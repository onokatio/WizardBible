x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x

--- 第5章: 基礎暗号学講座 〜 第1回 〜 ---

著者：IPUSIRON

x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x


■0x01.) はじめに

　今年の4月から、暗号の研究室に配属されました。現在セミナーで修士論文を書
くために文献を調べたり、暗号に関する知識の底上げをしています。セミナーは
週に2回あり、そのうち1回は私の発表することになっています。1回あたり3時間
の発表を行い、『現代暗号の基礎数理』（コロナ社）を半年で終わらせて、その
後修士論文の研究テーマを進めるということになっています。一応すべての章は
個人的に終わらせましたが、個人的に1ヶ月ずっとこの本をメインにして学んでき
たので、これをWBのネタにすることにしました。これでネタに困ることは当分な
いようです。この本をベースにして解説しますが、よくわからない方は『暗号技
術入門　秘密の国のアリス』をお勧めします。この本は万人にわかりやすいよう
に書かれていますし、例も面白くてどんどん読めると思います。

　ちなみに、今月号のネタではあまり数学的記述がありませんが、段々と数学を
使うことになります。あまり難しい数学はやりませんが、最低限でも高校卒業レ
ベルは習得しているという仮定で話をします。もしわからない概念が登場したら
自分で勉強してみてください。


■0x02.) 古典暗号と現代暗号

●古典暗号
　古典暗号とは、次の特徴を持つ暗号の総称です。
・暗号の作り方も鍵も秘密。
・暗号の安全性を言語の統計的特徴を基に議論する。
・暗号を使用する目的が主に軍事と外交。

　例えば、換字式暗号、転置式暗号などがそうです。有名なスキュタレー暗号、
シーザー暗号などは古典暗号です。
　古典暗号の暗号アルゴリズムを作るということは、一種の芸術的なものであり、
数学的な安全性評価というものがありません。

●現代暗号
　現代暗号とは、次の特徴を持つ暗号の総称です。
・暗号アルゴリズムは公開され、鍵のみが秘密。
　暗号・復号のアルゴリズムは公開されているので、誰でも知ることができ、そ
のためプログラムとして実装することも可能。
・暗号の安全性は計算量を基に議論する。
・一般社会において民間・個人にも使われる。

　例えば、DES暗号、AES暗号などの共通鍵暗号系、RSA暗号、ElGamal暗号などの
公開鍵暗号系が含まれます。そして、ゼロ知識型認証などの暗号プロトコルも含
まれます。

　この講座では現在暗号のみについて取り上げていきます。


■0x03.) 共通鍵暗号系

　共通鍵暗号系とは、送信者が平文Mと鍵Kを入力として暗号化アルゴリズムによ
り暗号文Cを出力します。その暗号文Cを通信路に通じて受信者の復号アルゴリズ
ムに入力します。その際、鍵Kを用います。その結果、平文Mを出力します。共通
鍵暗号系という名前からわかると思いますが、暗号化アルゴリズムと復号アルゴ
リズムで使われている鍵は両方とも共通するものです。あくまで暗号化アルゴリ
ズムと復号アルゴリズムは一般公開されているものなので、アタッカーももちろ
ん知っています。ということは、鍵Kがこの送信者と受信者の二人だけで秘密にし
ておかなければならないのです。もし、アタッカーの手に鍵Kが渡ってしまった場
合、盗聴した暗号文Cから簡単に平文Mを得てしまうことができてしまうわけです。
　ここで重要なのは、暗号化によって盗聴を防ぐわけではありません。盗聴され
ても内容がわからないようにするわけです。

　共通鍵暗号系は、ストリーム暗号とブロック暗号に大別されます。ストリーム
暗号とはその名の通りビットごとに処理し、ブロック暗号はビット列というブロ
ック単位で処理します。


■0x04.) XOR演算

　集合{0,1}上に、演算+を次のように定義します。普通は○の中に＋を書いた記
号を使いますが、テキスト表示では無理なので、+を代用することにします。

0+0=0
0+1=1
1+0=1
1+1=0

　これは、mod 2の世界の足し算と思えばよいでしょう。

0+0≡0　(mod 2)
0+1≡1　(mod 2)
1+0≡1　(mod 2)
1+1≡0　(mod 2)

　デジタル回路の世界では排他的論理和（XOR演算）として登場します。この講座
では今後XOR演算と呼ぶことにします。

　なぜこのような演算を定義したのかというと、共通鍵暗号系の仕組みのおいて
XOR演算が利用されているからです。

　2つのnビット列(a1,…,an)、(b1,…,bn)（∈{0,1}^n）があったとします。この
2つのビット列に対して、XOR演算をすることを次のように定義します。

(a1,…,an)+(b1,…,bn)=(a1+b1,…,an+bn)


■0x04.) ストリーム暗号

[定義]
平文のビット列M=(b1,b2,…)を、鍵のビット列K=(k1,k2,…)を用いて、
c1=b1+k1、c2=b2+k2、…
と暗号化する暗号系をストリーム暗号という。
このとき、暗号文は(c1,c2,…)となる。

（図）http://akademeia.info/main/image8/stream.jpg

ただし、iは1以上の整数。

　ストリーム暗号の特徴として次が挙げられます。
・シーザー暗号などの古典暗号、エニグマ暗号機を使う機械的暗号の多くが該当
する。
・ストリーム通信などで使われることもある。
・平文のサイズと暗号文のサイズが一致する。つまり、データのサイズが増えな
い。
・ソフトウェア実装だと効率が悪いが、ハードウェア実装だと回路規模が小さく
処理速度が高い。
・ブロック暗号と比べてストリーム暗号の研究は遅れていて、安全性の評価手法
の研究には長い時間を要する。そのため、ブロック暗号ベースのストリーム暗号
（例えば後ほど解説するがCFBやOFBがそう）を利用したほうがよいという考えも
ある。
・疑似乱数列の安全性に根拠を置くことになり、暗号学的に安全な疑似乱数を使
用する必要がある。
・送信側と受信側の間で鍵系列の同期の取り方により、同期式ストリーム暗号と
自己同期式ストリーム暗号に分類できる。

[定理]
Kが真にランダムならば、無限大の能力を有する敵に対しても安全である。

　Kを真にランダムにするには、平文MごとにKを新しく選びなおさなければなりま
せん。これを実現したものがバーナム暗号です。しかし、それでは効率が悪くな
ります。特にMが長ければ長いほど困難になってきます。
　そこで、疑似乱数生成器を用いて、短い鍵から長い疑似ランダムな鍵系列を生
成する方法が提案されています。

（図）http://akademeia.info/main/image8/stream2.jpg

　疑似乱数生成器を使うときのランダム値をシード（種）といいます。

　疑似乱数生成器はLFSR型と状態遷移型に大別されます。LFSR型には、線形フィ
ードバックシフトレジスタ（Line Feedback Shift Register：LFSR）、非線形な
FSR（Nonliner Feedback Shift Register：NFSR）があります。一方、状態遷移型
にはRC4やSEALがあります。
　これらの名前は今覚えなくてもいいです。ここで重要なのは完全な乱数列を作
ることは困難なので、一部の乱数値を入力として疑似乱数生成器を利用すること
で疑似乱数列を作られることが多いといことです。


■0x05.) ブロック暗号

　平文のビット列をブロック長と呼ばれるある一種の長さnごとに分割し、そのブ
ロック単位で暗号化を行います。この長さnは多くの場合、n=64やn=128であるこ
とが多いです。それはコンピュータが扱いやすい数にしたほうが便利だからです。

[定義]
ブロック長と呼ばれる長さnビットの平文mをまとめて暗号化する共通鍵暗号系を
ブロック暗号という。

　暗号化アルゴリズムをE_K、復号アルゴリズムをD_Kと表すことにします。Kと
いう添え字が付いているのは、Kを入力とされるということを明示するためです。

　ストリーム暗号では同一の平文m_i（iは添え字）が続けて入力されたとしても、
鍵k_iが次々変化していくために、暗号文c_iは異なる値になります。しかし、ブ
ロック暗号では、ストリーム暗号とは異なり、通常ある一定の期間同一の鍵が使
用されます。


■0x06.) 敵のモデル

　敵は何らかの方法で(平文,暗号文)の組(m1,c1),…,(m_q,c_q)を入手したとしま
す。この情報をもとに、鍵Kを求める攻撃を考えます。

　暗号攻撃にはあらゆるアプローチがあります。まずブルートフォースタック、
サイドチャネルアタック、ショートカット方式に分類できます。

●ブルートフォースアタック

○ブルートフォースアタック（全数探索攻撃）

　これは考えられる鍵をすべて総当り式に調べていくという方法です。このアタ
ックはすべての暗号において用いることができます。これはアタックの方法の中
でも一番時間がかかるもので、そのため通常このアタックで解読されてしまう可
能性のあるものは暗号として使えません。

○誕生日攻撃（バースデーアタック）＝暗号文一致攻撃

　バースデーパラドックスと呼ばれる「ランダムに23人を集めると誕生日が同じ
人間が2人以上いる確率が高い」という理論に基づいている攻撃方法です。一般化
すると、Nビットの出力がある場合は、2^(N/2)個程度の出力を集めると、その中
に同じデータが存在する可能性が高いという確率性をもとにして解析を進めます。

○辞書攻撃（ディクショナリーアタック）

　事前に、できる限り平文と暗号文のペアを管理しておいて、解析対象の文章と
一致するものを探し出す方法です。

●サイドチャネルアタック

　実装するハードウェアの特性を狙う方法です。個人的に大いに興味はあるが、
あまり数学的アプローチとは関係ないので、この講座では扱いません。よって、
軽く紹介するだけにします。

○SPA攻撃（Simple Power Analysis attack：単純電力解析攻撃）

○DPA攻撃（Differential Power Analysis attack：電力差分解析）

　SPA攻撃とDPA攻撃は、計算中に消費電力が増えることに注目したアタックです。

○タイミング攻撃

　計算している時間に注目したアタックです。

○キャッシュ攻撃

　自動的に鍵が変化していく暗号に対して、キャッシュメモリ内にデータにヒッ
トしたかどうかで計算時間が変化することに注目したアタックです。

○DFA攻撃（Differential Fault Analysis attack）

　外部から強力な光（レーザー光）などを照射することにより、意図的にエラー
を発生させて、それをもとに解読の手がかりを得るアタックです。

●ショートカット方式

　数学的に解を求める方式です。ここがこの講座のメインとなるところです。

○暗号文攻撃

　敵が知っているのは暗号文のみで、その暗号文からそれに対応する平文あるい
は鍵を解読しようとする方法です。

○既知平文攻撃

　敵に平文と暗号文のペアである(m1,c1)、…、(m_q,c_q)がランダムに与えられ、
そこから鍵Kを解読する方法です。

http://akademeia.info/main/image8/attacker1.jpg

○選択平文攻撃

　敵は平文m1,…,m_qを自由に選び、それに対応する暗号文を入手できるときに、
鍵Kを解読する方法です。

http://akademeia.info/main/image8/attacker2.jpg

○選択暗号文攻撃

　敵は選択平文攻撃に加えて、暗号文c1,…,c_qを自由に選び、それに対応する平
文を入手することができます。そういった状況で鍵Kを解読する方法です。

http://akademeia.info/main/image8/attacker3.jpg

　例として、すべてが1や0の暗号文を想定して、それを復号するとどうなるのか
を調べることができるので、敵の解読能力はとても高いといえる。

　ショートカット方式の場合は下の解読法のほうが敵に与えられる情報量が多く
なります。つまり、Kを解読できる可能性も高くなるわけです。

　ちなみに、暗号がある程度わかっているひとのために一応述べておきます。本
当は適応的かどうかも考慮しなければなりませんが、ここではとりあえずそれは
考えずに上記のことだけを理解しておいてください。


■0x07.) ブロック暗号の代表的な解読法

　ブロック暗号の代表的な解読法として差分解読法、線形解読法などがあります。
内容をきちんと説明すると膨大になってしまうの軽く紹介だけしておきます。ち
なみに、内容を理解できなくても、今後の講義には何の影響もないので安心して
ください。単にこういった解読法があると知っておくだけで十分です。

●差分解読法

　これは選択平文攻撃の一種です。1989年にイスラエルのEli BihamとAdi Shamir
によって発見されました。対応範囲が広く、多くのブロック暗号に有効です。NT
TのFEAL暗号もこれで解読されました。
　暗号鍵の全数探索法より高速な初めての解読法です。
　DESの暗号アルゴリズムは公開されていましたが、「なぜそのような計算をする
のか？」ということについて何も説明はありませんでした。後にIBMから1979年に
DESが発表されるより前の1974年の時点で、すでに差分解読法があることに気付い
ており、その対策を施していたという逸話もあります。

　解読者の目標は、うまく選んだ平文と暗号文のペア、および暗号化アルゴリズ
ムについての完全な情報のもとで鍵Kを特定することです。または、現実的には鍵
Kの可能性を、計算機で総当りに調べることが可能になる程度まで絞り込めればよ
いわけです。
　暗号化アルゴリズムがよほど簡単でない限り、ペアをたくさん集めても平文と
暗号文の相関はなかなか得ることはできません。しかし、平文を少し変化させた
ときに、その暗号文がどのくらい変化するのかを見てみたらどうなるだろうか？　
このアプローチが差分解読法です。

　まず2つのペア(m0,c0),(m1,c1)があったとします。このときペアの選び方は特
別の違いがあるようにします。すると、m0+m1=δ、c0+c1=δ'を求めることができ
る。このδ（∈{0,1}^n）は差分です。この差分が相関関係を表します。分布に偏
りがあれば、それを利用して鍵Kを求めます。つまり、「c1+c2=E_K(m1)+E_K(m2)
〜m1+m2」において、関係「〜」に何かあるかを調べるわけです。こおような関係
があるのは、統計的に確率は小さいかも知れません。しかし、期待できる理由は
あります。ブロック暗号の中では、鍵（の一部）が平文（の一部）とXOR演算を取
る操作が含まれることが多いからです。しかも、あらわに含まないとしても、結
果的に暗号化アルゴリズムのある部分がそのような操作に対応してしまっている
かもしれません。もしそうなら、暗号文2つの差分を取ることで、鍵の情報（の一
部）がXOR演算を2回取ることによって、キャンセルされて消えてしまうのです。
これはXOR演算の表を見てみればわかります。

　同じものをXOR演算するわけなので、「0+0」または「1+1」のどちらかです。ど
ちらの場合も結果は0になるわけなので、何かに0をXOR演算しても結果は変わりま
せん。軽くまとめておきます。

・0+0=0
・1+1=1
・A+0=A
・XOR演算は並びに依存しない。普通の加法+のように扱える。

　入力X,Y、鍵の部分Kとします。

(X+K)+(Y+K)=(X+Y)+(K+K)=(X+Y)+0=X+Y

　結果として、X+Yは鍵Kの影響を受けてないことがわかります。よって、入力差
分がある値になるように平文たちを選択して、このキャンセルの原理を利用して
鍵空間を狭めることができて、対応する暗号文たちをもとにして鍵を推定するの
です。実際、DES暗号の場合は、ラウンドを通り抜けるにつれて、違いがどう発展
するかを分析します。

●線形解読法

　平文と暗号文の組(m,c)と鍵Kの間の何らかの線形関係式を考えます。ここで、
鍵Kを固定したとき、その線形関係式を成立させる(m,c)の個数がある程度以上に
多い場合、その偏りの事実を利用して鍵を求める解読法です。
　1994年に12台のワークステーションを利用して、線形解読法を利用して50日間
でDES暗号を解析しました。これが世界初のDES暗号の解読となりました。DESを設
計したIBMの研究者は差分解読法は想定していたが、線形解読法は予想外であった
といいます。


■0x08.) 終わりに

　今回の講義は基本中の基本なので特に難しいところはなかったと思います。も
し何かわからないことがありましたら、質問掲示板の質問スレに投稿お願いしま
す。私の知ってる範囲で答えられるかもしれません。

http://ruffnex.oc.to/ipusiron/cgi/forum/patio.cgi?mode=view&no=427

　次回はまず最初に情報理論的に安全ということを定義し、ランダム置換やラン
ダム関数を解説します。そして、ブロック暗号の各モードを紹介しつつ、それら
で使われる暗号化アルゴリズムをランダム置換やランダム関数にしたときに情報
理論的に安全かどうかを数学的にきちんと考えていきます。


