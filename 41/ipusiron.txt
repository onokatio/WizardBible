x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x

--- 第○章: 基礎暗号学講座・第16回 〜拡張ElGamal暗号〜  ---

著者：IPUSIRON

x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x


■0x01.) はじめに

　前回のWBでは公開鍵暗号の安全性について言及した。今回は公開鍵暗号の一種
である拡張ElGamal暗号の仕様とその安全性を紹介する。拡張ElGamal暗号はWB33
で紹介したElGamal暗号を改良したものである。

　ElGamal暗号はCDH仮定の下で、OW-CPA安全である。一方、拡張ElGamal暗号はD
DH仮定の下で、IND-CPA安全です。安全性は高くなっていることがわかる。一方、
仮定は強くなってしまっているように見えるが、厳密には用いている群が違うこ
とに注意して欲しい。詳細は今回の記事で触れている。


■0x02.) 拡張ElGamal暗号の仕様

　公開鍵暗号は鍵生成アルゴリズム・暗号化アルゴリズム・復号アルゴリズムの
3つのアルゴリズムで構成される。よって、拡張ElGamal暗号も3つのアルゴリズム
で構成されている。

●鍵生成アルゴリズム

　セキュリティパラメータを入力とする。

1：q|p-1を満たす大きな素数p,qを生成する。

2：位数がqとなる、Z_p^*の元αを生成する。

3：0≦x＜qとなるxをランダムに選択し、y=α^x mod pを計算する。

4：公開鍵pk=(p,q,α,y)、秘密鍵sk=xを出力する。

●暗号化アルゴリズム

　αで構成される巡回群の元を平文mとし、mとpkを入力とする。

1：0≦r＜qとなるrをランダムに選択する。

2：c1=α^r mod p、c2=my^r mod pを計算する。

3：ステップ2で計算したc1,c2を組として、暗号文cとする。そのc=(c1,c2)を出力
する。

●復号アルゴリズム

　暗号文c=(c1,c2)、skを入力とする。

1：c2/(c1^x) mod pを計算して出力する。


■0x03.) アルゴリズムの補足

　以上の3つのアルゴリズムがElGamal暗号の仕様になる。いくつか補足したい部
分がある。

　ElGamal暗号で用いた群はZ_p^*であった。うまいZ_p^*の部分群を使うことで、
Z_p^*のときのDL問題・CDH問題・DDH問題よりも解くのが困難になるのである。H
がGの部分群であるとは、HがGの部分集合であり、なおかつHがGと演算が同じであ
ると定義される。
　部分群を用いた方が問題が困難になるという事実を利用したのが拡張ElGamal暗
号である。そのため、拡張ElGamal暗号の鍵生成アルゴリズムの中に、Z_p^*の部
分群を使うための準備が含まれているのである。

　鍵生成アルゴリズムのステップ1における「q|p-1」とは、qがp-1を割り切ると
いう意味である。例えば、p=2q+1の関係などがそうである。このような関係であ
る素数p,qは次のように生成することができる。

1：大きな素数qを生成する。

2：乱数rを選び、p=2rq+1とする。

3：pが素数かどうかを確認し、素数でないならステップ1に戻る。もしpが素数で
あれば、(p,q)はq|p-1を満たしている。

　また、鍵生成アルゴリズムのステップ2において、位数という言葉が登場してい
る。すでに位数は定義済みだが、ここでも復習しておく。kが位数とは、g^k mod
 p = 1を満たすような最小の値のことである。ステップ2で主張する位数がqとな
るZ_p^*の元αが存在するのを保証するのは、ステップ1によってq|p-1が成り立つ
からである。これは次のように証明することができる。

　背理法を用いる。位数q（＝ord_p(a)）がp-1を割り切らないと仮定する。する
と、p-1=k×q+r、0＜r＜qと書ける。
　また次のような計算ができる。

1
≡a^(p-1) mod p　（∵フェルマーの小定理）
≡a^(k×q+r)
≡a^(k×q)・a^r
≡a^r（∵定義よりa^q≡1 mod p）

　よって、a^r≡1 mod pが成り立つ。
　しかし、r＜qであるが、qの最小性（位数の定義）に反する。ゆえに、位数q（
＝ord_p(a)）はp-1を割り切る。　□

　そして、このαの生成方法は、Z_p^*の原始元gを求めて、α=g^(2r) mod pを計
算すればよい。このαの位数はqになっている。即ち、α^q≡1 mod pが成り立つ。
しかも、このαの位数はqのみである。この事実は次のように証明できる。

　p-1=2rqかつα=g^(2r) mod pより、

α^q
=(g^(2r))^q
=g^(2rq)
=g^(p-1)　（∵p-1=2rq）
=1 mod p　（∵フェルマーの小定理）

　また、α^i≡1 mod pとなるi（1≦i＜q）が存在すると仮定すると、

（左辺）
=α^i
≡(g^(2r))^i
=g^(2ri)

と計算できるので、g^(2ri)≡1 mod pが成り立つ。

　ここでgの位数は2ri＜2rq=p-1より小さい。これはgが原始元であることに反す
る。

　よって、α^i≡1 mod qとなるi（1≦i＜q）は存在しない。ゆえに、αの位数は
qのみである。　□

　α^q≡1 mod pが成り立つため、任意の整数iに対してα^iはα^(i mod q) mod
 pと考えればよい。つまり、αの指数部はmod qの世界で考えればよいのである。
よって、このαの巡回群はq個であり、この巡回群の要素は1 mod p,α mod p,α^2
 mod p,…,α^(q-1) mod pになる。この巡回群を＜α＞と定義する。


■0x04.) 完全性

　アルゴリズムが定義されたならば、まず完全性を確認する必要がある。完全性
とは復号アルゴリズムを実行すると、平文に戻ることである。つまり、c2/(c1^x)
 mod pを式展開して、mになれば完全性が成り立つ。

c2/(c1^x) mod p
=(my^r)/(α^(rx))
=(mα^(xr))/(α^(rx))
=m　□

　よって、完全性が示された。


■0x05.) 安全性

　「＜α＞に対するDDH問題が困難であれば、拡張ElGamal暗号はIND-CPA安全であ
る」ことを証明したい。

　これを証明するために対偶で考える。つまり、IND−CPA安全を解くアルゴリズ
ムAが存在するならば、＜α＞に対するDDH問題を解くアルゴリズムBが存在するこ
とを示すことができればよい。ここでAの成功確率を(1/2)+εとする。

　証明方法はいつもお馴染みの帰着法である。Aの力を利用して、Bを構成するこ
とができ、そのBの成功確率がε以上であればよいのである。

　まずBの構成を示す。
　Bに(α,β,γ,δ)=(α,α^x,α^y,α^z)が与えられるとする。Bの目的はうまく
細工をすることにより、Aの力を利用して、z=xy mod qかどうかを有意な確率で判
定することである。
　Bは(α,β,γ,δ)を入力とし、pk=(p,q,α,β)をAに公開鍵として与える。この
とき、このpkが拡張ElGamal暗号の公開鍵と同じ分布の必要があるが、p,q,α,β
すべて同一なため敵はBの中で動作していることに気が付かないので、問題ない。
　次に、AはCPA攻撃者なので2つの平文m0,m1を外に送る。AはBの内部でm0,m1を送
信する。Bはそれらを受け取ったら、1ビットのbをランダムに選択する。そして、
Bはc=(γ,m_bγ)を暗号文としてAに送信する。ここでBが細工しているのである。
このcも拡張ElGamal暗号の仕様通りに作られた(c1,c2)とまったく同一の分布を示
すため、AはBの中にいることに気付かないため、問題ない。つまり、Aはcが細工
されているのに気付かないのである。
　Aは最後にbの推測として~bをローカル出力する。
　Bは~bを見て、b=~bが成り立っていれば1（ここではz=xyが成り立っていること
を意味する）を出力し、b≠~bが成り立っていれば0（ここではz≠xyが成り立って
いることを意味する）をローカル出力する。
　以上でBの構成は完了である。

　次に、Bの成功確率を調べる必要がある。

[1]z=xyの場合

　pkとcは拡張ElGamal暗号の仕様通りのpk,cと分布がまったく同一である。
　よって、仮定よりAは(1/2)+ε以上の確率で、b=~bとなる~bを出力するはずであ
る。
　ゆえに、z=xyの場合にBは(1/2)+ε以上の確率で1を出力する。つまり、Bは(1/
2)+ε以上の確率でz=xyであることを判定できる。

[2]z≠xyの場合

　pkは拡張ElGamal暗号の仕様通りのpkと分布がまったく同一である。また、c=(
γ,m_bγ)=(γ,m_bα^z)である。α^zはZ_p^*上でランダムなので、m_bα^zもZ_p^*
上でランダムである。よって、このcは完全にbの情報を隠している。
　よって、Aは1/2の確率でしか、b=~bとなる~bを出力するしかない。
　ゆえに、z≠xyの場合にBは1/2の確率で1を出力する。

　したがって、Bの成功確率は次のように計算できる。

Adv(B)
=Pr[B outputs 1|z=xy]-Pr[B outputs 1|z≠xy]
≧((1/2)+ε)-(1/2)
=ε

　つまり、Bの成功確率はε以上であることがわかった。つまり、Aの存在を仮定
して、Bの存在を示すことができる。
　しかし、＜α＞に対するDDH問題が困難であることを仮定すれば、Bの存在と矛
盾する。よって、拡張ElGamal暗号をIND-CPA攻撃に成功する敵は存在しない。つ
まり、＜α＞に対するDDH問題が困難であるならば、拡張ElGamal暗号はIND-CPA安
全であることが言える。　□


■0x06.) 最後に

　今回の基礎暗号学講座・第16回でようやく3つの公開鍵暗号の仕様とその安全性
を示すことができた。まだまだ公開鍵暗号は存在するので、今後も具体的な公開
鍵暗号をもう少し追いかけてみたい。
　次回は公開鍵暗号の一種であるRabin暗号に準備に必要な数学的概念を解説する
予定である。



